diff -Naur klone-core-2.1.1/klone/http.h klone-core-2.1.1-atinar/klone/http.h
--- klone-core-2.1.1/klone/http.h	2007-11-09 23:06:26.000000000 +0100
+++ klone-core-2.1.1-atinar/klone/http.h	2009-11-04 02:34:45.000000000 +0100
@@ -31,6 +31,8 @@
     /**< request accepted but processing not completed */
     HTTP_STATUS_NO_CONTENT                = 204,
     /**< no body returned */
+    HTTP_PARTIAL_CONTENT                  = 206,
+    /**< partial content returned */
     HTTP_STATUS_MOVED_PERMANENTLY         = 301,
     /**< resource relocated permanently */
     HTTP_STATUS_MOVED_TEMPORARILY         = 302,
diff -Naur klone-core-2.1.1/klone/request.h klone-core-2.1.1-atinar/klone/request.h
--- klone-core-2.1.1/klone/request.h	2008-06-04 19:48:01.000000000 +0200
+++ klone-core-2.1.1-atinar/klone/request.h	2010-01-24 03:40:07.000000000 +0100
@@ -77,7 +77,7 @@
 
 vars_t *request_get_uploads(request_t *rq);
 int request_get_uploaded_file(request_t *rq, const char *name, size_t idx, 
-    char local_filename[U_PATH_MAX], char client_filename[U_PATH_MAX], 
+    char local_filename[U_FILENAME_MAX], char client_filename[U_FILENAME_MAX], 
     char mime_type[MIME_TYPE_BUFSZ], size_t *file_size);
 
 vars_t *request_get_args(request_t *rq);
diff -Naur klone-core-2.1.1/klone/utils.h klone-core-2.1.1-atinar/klone/utils.h
--- klone-core-2.1.1/klone/utils.h	2008-04-08 14:53:49.000000000 +0200
+++ klone-core-2.1.1-atinar/klone/utils.h	2009-11-04 03:20:39.000000000 +0100
@@ -62,6 +62,7 @@
 enum { U_COPY_VERBATIM, U_COPY_ENCODE, U_COPY_DECODE };
 
 enum { URLCPY_VERBATIM, URLCPY_ENCODE, URLCPY_DECODE };
+ssize_t u_urlncpy_encode(char *d, const char *s, size_t slen, const char *keep);
 ssize_t u_urlncpy(char *dst, const char *src, size_t slen, int flags);
 
 enum { HEXCPY_VERBATIM, HEXCPY_ENCODE, HEXCPY_DECODE };
diff -Naur klone-core-2.1.1/src/libhttp/http.c klone-core-2.1.1-atinar/src/libhttp/http.c
--- klone-core-2.1.1/src/libhttp/http.c	2008-07-11 17:45:18.000000000 +0200
+++ klone-core-2.1.1-atinar/src/libhttp/http.c	2009-11-04 02:34:45.000000000 +0100
@@ -50,6 +50,7 @@
     { HTTP_STATUS_CREATED               , "Created"                 },
     { HTTP_STATUS_ACCEPTED              , "Accepted"                },
     { HTTP_STATUS_NO_CONTENT            , "No Content"              },
+    { HTTP_PARTIAL_CONTENT              , "Partial Content"         },
     { HTTP_STATUS_BAD_REQUEST           , "Bad Request"             },
     { HTTP_STATUS_UNAUTHORIZED          , "Unauthorized"            },
     { HTTP_STATUS_FORBIDDEN             , "Forbidden"               },
diff -Naur klone-core-2.1.1/src/libutils/utils.c klone-core-2.1.1-atinar/src/libutils/utils.c
--- klone-core-2.1.1/src/libutils/utils.c	2008-04-08 14:53:49.000000000 +0200
+++ klone-core-2.1.1-atinar/src/libutils/utils.c	2009-11-04 02:52:50.000000000 +0100
@@ -309,11 +309,13 @@
     return -1;
 }
 
-static ssize_t u_urlncpy_encode(char *d, const char *s, size_t slen)
+ssize_t u_urlncpy_encode(char *d, const char *s, size_t slen, const char *keep)
 {
     const char hexc[] = "0123456789ABCDEF";
     ssize_t wr = 0;
     unsigned char c;
+    const char default_keep[] = "-_."; //~/:?=&"; //!*'();@+$,[]#%"; 
+    if (keep==NULL) keep=default_keep;
 
     dbg_return_if (d == NULL, -1);
     dbg_return_if (s == NULL, -1);
@@ -324,7 +326,7 @@
         if(c == ' ') {
             *d++ = '+';
             wr++;
-        } else if(isalnum(c) || c == '_' || c == '-' || c == '.') {
+        } else if ((c>='A' && c<='Z') || (c>='a' && c<='z') || (c>='0' && c<='9') || strchr(keep,c)) {
             *d++ = c;
             wr++;
         } else {
@@ -396,7 +398,7 @@
     switch(flags)
     {
     case URLCPY_ENCODE:
-        return u_urlncpy_encode(d, s, slen);
+        return u_urlncpy_encode(d, s, slen, NULL);
     case URLCPY_DECODE:
         return u_urlncpy_decode(d, s, slen);
     default:
