diff -Naur osdteletext-0.8.3-orig/buildutil/pot2i18n.pl osdteletext-0.8.3/buildutil/pot2i18n.pl
--- osdteletext-0.8.3-orig/buildutil/pot2i18n.pl	1970-01-01 01:00:00.000000000 +0100
+++ osdteletext-0.8.3/buildutil/pot2i18n.pl	2009-08-23 20:54:07.000000000 +0200
@@ -0,0 +1,157 @@
+#!/usr/bin/perl
+#
+#  File:	pot2i18n.pl - Convert plugin pot file into i18n.c-format
+#  Author:	Dieter Hametner
+#  Version:	0.1
+#
+#  based on po2i18n.pl version 0.1 from Udo Richter
+#
+#  See the po2i18n/README file for copyright information and how to
+#  reach the original author. Also general use is described there.
+#
+#  This version uses the CPAN module Locale::PO to read the .pot and .po files
+#  which ensures, that these files are read correctly.
+#
+#  The usage of pot2i18n.pl differs from po2i18n.pl that it requires as first
+#  argument the path to the plugins .pot file. There it then looks also for
+#  the translated .po files which are used to create the result.
+#  This version does not sort the msgids lexicaly (in contrast to po2i18n.pl)
+
+use strict;
+use warnings;
+
+use Locale::PO;
+use File::Basename;
+
+my @LANGS = (
+  "en_US",
+  "de_DE",
+  "sl_SI",
+  "it_IT",
+  "nl_NL",
+  "pt_PT",
+  "fr_FR",
+  "nn_NO",
+  "fi_FI",
+  "pl_PL",
+  "es_ES",
+  "el_GR",
+  "sv_SE",
+  "ro_RO",
+  "hu_HU",
+  "ca_ES",
+  "ru_RU",
+  "hr_HR",
+  "et_EE",
+  "da_DK",
+  "cs_CZ",
+  "tr_TR"
+  );
+
+my %VERS = (
+  "en_US" => 10200,
+  "de_DE" => 10200,
+  "sl_SI" => 10200,
+  "it_IT" => 10200,
+  "nl_NL" => 10200,
+  "pt_PT" => 10200,
+  "fr_FR" => 10200,
+  "nn_NO" => 10200,
+  "fi_FI" => 10200,
+  "pl_PL" => 10200,
+  "es_ES" => 10200,
+  "el_GR" => 10200,
+  "sv_SE" => 10200,
+  "ro_RO" => 10200,
+  "hu_HU" => 10200,
+  "ca_ES" => 10200,
+  "ru_RU" => 10302,
+  "hr_HR" => 10307,
+  "et_EE" => 10313,
+  "da_DK" => 10316,
+  "cs_CZ" => 10342,
+  "tr_TR" => 10502
+  );
+
+die "Missing .pot file argument" unless $#ARGV >= 0;
+
+my $potfile = $ARGV[0];
+my $podir = dirname($potfile);
+
+my $potRef = Locale::PO->load_file_asarray($potfile);
+shift;
+
+my %translations;
+
+foreach my $lang (@LANGS) {
+    $translations{$lang} = Locale::PO->load_file_ashash("$podir/$lang.po");
+}
+
+# debugging code: (may be removed)
+#for my $po (@{$potRef}) {
+#    my $msgid = $po->msgid;
+#
+#    print "UNTRANSLATED: ", $msgid, "\n";
+#    next if $msgid eq "\"\"";
+#    foreach my $lang (@LANGS) {
+#	my $lhref = $translations{$lang};
+#	my $lpo = ${$lhref}{$msgid};
+#	$lpo = $po if !defined $lpo;
+#
+#	my $msg = $lpo->msgstr;
+#	$msg = $lpo->msgid if !defined $msg;
+#	$msg = $msgid if ($lang eq "en_US");
+#	print $lang, ": ", $msg, "\n";
+#    }
+#    print "\n";
+#}
+#
+#exit;
+
+my $silent = 0;
+
+while (<>) {
+    my $line = $_;
+
+    if ($line =~ /^\/\/ START I18N/) {
+        print "// START I18N - automatically generated by pot2i18n.pl\n";
+	foreach my $po (@{$potRef}) {
+	    my $msgid = $po->msgid;
+            next if $msgid eq "\"\"";
+
+            my $head = "  { ";
+            my $endif = "";
+            my $versnum = 10200;
+
+            for my $lang (@LANGS) {
+                if ($VERS{$lang} ne $versnum) {
+                    $versnum = $VERS{$lang};
+                    print $endif;
+                    print "#if VDRVERSNUM >= $versnum\n";
+                    $endif = "#endif\n";
+                }
+
+		my $lhref = $translations{$lang};
+		my $lpo = ${$lhref}{$msgid};
+		$lpo = $po if !defined $lpo;
+
+		my $msgstr = $lpo->msgstr;
+		$msgstr = $lpo->msgid if !defined $msgstr;
+		$msgstr = $msgid if ($lang eq "en_US");
+
+                print "$head$msgstr,\n";
+                $head = "    ";
+            }
+            print $endif;
+            print "  },\n";
+        }
+        $silent = 1;
+    }
+
+    if (!$silent) { print $line; }
+
+    if ($line =~ /^\/\/ END I18N/) {
+        print "// END I18N - automatically generated by pot2i18n.pl\n";
+        $silent = 0;
+    }
+}
diff -Naur osdteletext-0.8.3-orig/hamm.c osdteletext-0.8.3/hamm.c
--- osdteletext-0.8.3-orig/hamm.c	1970-01-01 01:00:00.000000000 +0100
+++ osdteletext-0.8.3/hamm.c	2009-12-18 14:15:14.651500134 +0100
@@ -0,0 +1,313 @@
+/*
+ *  libzvbi - Error correction functions
+ *
+ *  Copyright (C) 2001, 2002, 2003, 2004 Michael H. Schimek
+ *
+ *  Based on code from AleVT 1.5.1
+ *  Copyright (C) 1998, 1999 Edgar Toernig <froese@gmx.de>
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+/* $Id: hamm.c,v 1.15 2005/06/28 01:00:59 mschimek Exp $ */
+
+#include <limits.h>		/* CHAR_BIT */
+#include "hamm.h"
+
+const uint8_t
+_vbi3_bit_reverse [256] = {
+	0x00, 0x80, 0x40, 0xc0, 0x20, 0xa0, 0x60, 0xe0,	
+	0x10, 0x90, 0x50, 0xd0, 0x30, 0xb0, 0x70, 0xf0,
+	0x08, 0x88, 0x48, 0xc8, 0x28, 0xa8, 0x68, 0xe8,	
+	0x18, 0x98, 0x58, 0xd8, 0x38, 0xb8, 0x78, 0xf8,
+
+	0x04, 0x84, 0x44, 0xc4, 0x24, 0xa4, 0x64, 0xe4,	
+	0x14, 0x94, 0x54, 0xd4, 0x34, 0xb4, 0x74, 0xf4,
+	0x0c, 0x8c, 0x4c, 0xcc, 0x2c, 0xac, 0x6c, 0xec,	
+	0x1c, 0x9c, 0x5c, 0xdc, 0x3c, 0xbc, 0x7c, 0xfc,
+
+	0x02, 0x82, 0x42, 0xc2, 0x22, 0xa2, 0x62, 0xe2,	
+	0x12, 0x92, 0x52, 0xd2, 0x32, 0xb2, 0x72, 0xf2,
+	0x0a, 0x8a, 0x4a, 0xca, 0x2a, 0xaa, 0x6a, 0xea,	
+	0x1a, 0x9a, 0x5a, 0xda, 0x3a, 0xba, 0x7a, 0xfa,
+
+	0x06, 0x86, 0x46, 0xc6, 0x26, 0xa6, 0x66, 0xe6,	
+	0x16, 0x96, 0x56, 0xd6, 0x36, 0xb6, 0x76, 0xf6,
+	0x0e, 0x8e, 0x4e, 0xce, 0x2e, 0xae, 0x6e, 0xee,	
+	0x1e, 0x9e, 0x5e, 0xde, 0x3e, 0xbe, 0x7e, 0xfe,
+
+	0x01, 0x81, 0x41, 0xc1, 0x21, 0xa1, 0x61, 0xe1,	
+	0x11, 0x91, 0x51, 0xd1, 0x31, 0xb1, 0x71, 0xf1,
+	0x09, 0x89, 0x49, 0xc9, 0x29, 0xa9, 0x69, 0xe9,	
+	0x19, 0x99, 0x59, 0xd9, 0x39, 0xb9, 0x79, 0xf9,
+
+	0x05, 0x85, 0x45, 0xc5, 0x25, 0xa5, 0x65, 0xe5,	
+	0x15, 0x95, 0x55, 0xd5, 0x35, 0xb5, 0x75, 0xf5,
+	0x0d, 0x8d, 0x4d, 0xcd, 0x2d, 0xad, 0x6d, 0xed,	
+	0x1d, 0x9d, 0x5d, 0xdd, 0x3d, 0xbd, 0x7d, 0xfd,
+
+	0x03, 0x83, 0x43, 0xc3, 0x23, 0xa3, 0x63, 0xe3,	
+	0x13, 0x93, 0x53, 0xd3, 0x33, 0xb3, 0x73, 0xf3,
+	0x0b, 0x8b, 0x4b, 0xcb, 0x2b, 0xab, 0x6b, 0xeb,	
+	0x1b, 0x9b, 0x5b, 0xdb, 0x3b, 0xbb, 0x7b, 0xfb,
+
+	0x07, 0x87, 0x47, 0xc7, 0x27, 0xa7, 0x67, 0xe7,	
+	0x17, 0x97, 0x57, 0xd7, 0x37, 0xb7, 0x77, 0xf7,
+	0x0f, 0x8f, 0x4f, 0xcf, 0x2f, 0xaf, 0x6f, 0xef,	
+	0x1f, 0x9f, 0x5f, 0xdf, 0x3f, 0xbf, 0x7f, 0xff
+};
+
+/**
+ * @ingroup Error
+ *
+ * @param p Array of unsigned bytes.
+ * @param n Size of array.
+ * 
+ * Of each byte of the array, changes the most significant
+ * bit to make the number of set bits odd.
+ */
+void
+vbi3_par				(uint8_t *		p,
+				 unsigned long		n)
+{
+	while (n-- > 0) {
+		uint8_t c = *p;
+
+		/* if 0 == (inv_par[] & 32) change msb of *p. */
+		*p++ = c ^ (128 & ~(_vbi3_hamm24_inv_par[0][c] << 2));
+	}
+}
+
+/**
+ * @ingroup Error
+ * @param p Array of unsigned bytes.
+ * @param n Size of array.
+ * 
+ * Tests the parity and clears the most significant bit of
+ * each byte of the array.
+ *
+ * @return
+ * A negative value if any byte of the array had even
+ * parity (sum of bits modulo 2 is 0).
+ */
+int
+vbi3_unpar			(uint8_t *		p,
+				 unsigned long		n)
+{
+	int r = 0;
+
+	while (n-- > 0) {
+		uint8_t c = *p;
+
+		/* if 0 == (inv_par[] & 32) set msb of r. */
+		r |= ~ _vbi3_hamm24_inv_par[0][c]
+			<< (sizeof (int) * CHAR_BIT - 1 - 5);
+
+		*p++ = c & 127;
+	}
+
+	return r;
+}
+
+/* ETS 300 706, Section 8.2 Hamming 8/4 */
+
+const uint8_t
+_vbi3_hamm8_fwd [16] = {
+	0x15, 0x02, 0x49, 0x5e, 0x64, 0x73, 0x38, 0x2f,
+	0xd0, 0xc7, 0x8c, 0x9b, 0xa1, 0xb6, 0xfd, 0xea
+};
+
+const int8_t
+_vbi3_hamm8_inv [256] = {
+	0x01,   -1, 0x01, 0x01,   -1, 0x00, 0x01,   -1, 
+	  -1, 0x02, 0x01,   -1, 0x0a,   -1,   -1, 0x07, 
+	  -1, 0x00, 0x01,   -1, 0x00, 0x00,   -1, 0x00, 
+	0x06,   -1,   -1, 0x0b,   -1, 0x00, 0x03,   -1, 
+
+	  -1, 0x0c, 0x01,   -1, 0x04,   -1,   -1, 0x07, 
+	0x06,   -1,   -1, 0x07,   -1, 0x07, 0x07, 0x07, 
+	0x06,   -1,   -1, 0x05,   -1, 0x00, 0x0d,   -1, 
+	0x06, 0x06, 0x06,   -1, 0x06,   -1,   -1, 0x07, 
+
+	  -1, 0x02, 0x01,   -1, 0x04,   -1,   -1, 0x09, 
+	0x02, 0x02,   -1, 0x02,   -1, 0x02, 0x03,   -1, 
+	0x08,   -1,   -1, 0x05,   -1, 0x00, 0x03,   -1, 
+	  -1, 0x02, 0x03,   -1, 0x03,   -1, 0x03, 0x03, 
+
+	0x04,   -1,   -1, 0x05, 0x04, 0x04, 0x04,   -1, 
+	  -1, 0x02, 0x0f,   -1, 0x04,   -1,   -1, 0x07, 
+	  -1, 0x05, 0x05, 0x05, 0x04,   -1,   -1, 0x05, 
+	0x06,   -1,   -1, 0x05,   -1, 0x0e, 0x03,   -1, 
+
+	  -1, 0x0c, 0x01,   -1, 0x0a,   -1,   -1, 0x09, 
+	0x0a,   -1,   -1, 0x0b, 0x0a, 0x0a, 0x0a,   -1, 
+	0x08,   -1,   -1, 0x0b,   -1, 0x00, 0x0d,   -1, 
+	  -1, 0x0b, 0x0b, 0x0b, 0x0a,   -1,   -1, 0x0b, 
+
+	0x0c, 0x0c,   -1, 0x0c,   -1, 0x0c, 0x0d,   -1, 
+	  -1, 0x0c, 0x0f,   -1, 0x0a,   -1,   -1, 0x07, 
+	  -1, 0x0c, 0x0d,   -1, 0x0d,   -1, 0x0d, 0x0d, 
+	0x06,   -1,   -1, 0x0b,   -1, 0x0e, 0x0d,   -1, 
+
+	0x08,   -1,   -1, 0x09,   -1, 0x09, 0x09, 0x09, 
+	  -1, 0x02, 0x0f,   -1, 0x0a,   -1,   -1, 0x09, 
+	0x08, 0x08, 0x08,   -1, 0x08,   -1,   -1, 0x09, 
+	0x08,   -1,   -1, 0x0b,   -1, 0x0e, 0x03,   -1, 
+
+	  -1, 0x0c, 0x0f,   -1, 0x04,   -1,   -1, 0x09, 
+	0x0f,   -1, 0x0f, 0x0f,   -1, 0x0e, 0x0f,   -1, 
+	0x08,   -1,   -1, 0x05,   -1, 0x0e, 0x0d,   -1, 
+	  -1, 0x0e, 0x0f,   -1, 0x0e, 0x0e,   -1, 0x0e
+};
+
+/* ETS 300 706, Section 8.3 Hamming 18/24 (code from AleVT) */
+
+/* This table generates the parity checks for hamm24/18 decoding.
+   Bit 0 is for test A, 1 for B, ...
+   Thanks to R. Gancarz for this fine table *g* */
+const int8_t
+_vbi3_hamm24_inv_par [3][256] = {
+    {
+        /* Parities of first byte */
+	 0, 33, 34,  3, 35,  2,  1, 32, 36,  5,  6, 39,  7, 38, 37,  4,
+	37,  4,  7, 38,  6, 39, 36,  5,  1, 32, 35,  2, 34,  3,  0, 33,
+	38,  7,  4, 37,  5, 36, 39,  6,  2, 35, 32,  1, 33,  0,  3, 34,
+	 3, 34, 33,  0, 32,  1,  2, 35, 39,  6,  5, 36,  4, 37, 38,  7,
+
+	39,  6,  5, 36,  4, 37, 38,  7,  3, 34, 33,  0, 32,  1,  2, 35,
+	 2, 35, 32,  1, 33,  0,  3, 34, 38,  7,  4, 37,  5, 36, 39,  6,
+	 1, 32, 35,  2, 34,  3,  0, 33, 37,  4,  7, 38,  6, 39, 36,  5,
+	36,  5,  6, 39,  7, 38, 37,  4,  0, 33, 34,  3, 35,  2,  1, 32,
+
+	40,  9, 10, 43, 11, 42, 41,  8, 12, 45, 46, 15, 47, 14, 13, 44,
+	13, 44, 47, 14, 46, 15, 12, 45, 41,  8, 11, 42, 10, 43, 40,  9,
+	14, 47, 44, 13, 45, 12, 15, 46, 42, 11,  8, 41,  9, 40, 43, 10,
+	43, 10,  9, 40,  8, 41, 42, 11, 15, 46, 45, 12, 44, 13, 14, 47,
+
+	15, 46, 45, 12, 44, 13, 14, 47, 43, 10,  9, 40,  8, 41, 42, 11,
+	42, 11,  8, 41,  9, 40, 43, 10, 14, 47, 44, 13, 45, 12, 15, 46,
+	41,  8, 11, 42, 10, 43, 40,  9, 13, 44, 47, 14, 46, 15, 12, 45,
+	12, 45, 46, 15, 47, 14, 13, 44, 40,  9, 10, 43, 11, 42, 41,  8
+    }, { 
+        /* Parities of second byte */
+	 0, 41, 42,  3, 43,  2,  1, 40, 44,  5,  6, 47,  7, 46, 45,  4,
+	45,  4,  7, 46,  6, 47, 44,  5,  1, 40, 43,  2, 42,  3,  0, 41,
+	46,  7,  4, 45,  5, 44, 47,  6,  2, 43, 40,  1, 41,  0,  3, 42,
+	 3, 42, 41,  0, 40,  1,  2, 43, 47,  6,  5, 44,  4, 45, 46,  7,
+
+	47,  6,  5, 44,  4, 45, 46,  7,  3, 42, 41,  0, 40,  1,  2, 43,
+	 2, 43, 40,  1, 41,  0,  3, 42, 46,  7,  4, 45,  5, 44, 47,  6,
+	 1, 40, 43,  2, 42,  3,  0, 41, 45,  4,  7, 46,  6, 47, 44,  5,
+	44,  5,  6, 47,  7, 46, 45,  4,  0, 41, 42,  3, 43,  2,  1, 40,
+
+	48, 25, 26, 51, 27, 50, 49, 24, 28, 53, 54, 31, 55, 30, 29, 52,
+	29, 52, 55, 30, 54, 31, 28, 53, 49, 24, 27, 50, 26, 51, 48, 25,
+	30, 55, 52, 29, 53, 28, 31, 54, 50, 27, 24, 49, 25, 48, 51, 26,
+	51, 26, 25, 48, 24, 49, 50, 27, 31, 54, 53, 28, 52, 29, 30, 55,
+
+	31, 54, 53, 28, 52, 29, 30, 55, 51, 26, 25, 48, 24, 49, 50, 27,
+	50, 27, 24, 49, 25, 48, 51, 26, 30, 55, 52, 29, 53, 28, 31, 54,
+	49, 24, 27, 50, 26, 51, 48, 25, 29, 52, 55, 30, 54, 31, 28, 53,
+	28, 53, 54, 31, 55, 30, 29, 52, 48, 25, 26, 51, 27, 50, 49, 24
+    }, { 
+        /* Parities of third byte, xor 0x3F */
+	63, 14, 13, 60, 12, 61, 62, 15, 11, 58, 57,  8, 56,  9, 10, 59,
+	10, 59, 56,  9, 57,  8, 11, 58, 62, 15, 12, 61, 13, 60, 63, 14,
+	 9, 56, 59, 10, 58, 11,  8, 57, 61, 12, 15, 62, 14, 63, 60, 13,
+	60, 13, 14, 63, 15, 62, 61, 12,  8, 57, 58, 11, 59, 10,  9, 56,
+
+	 8, 57, 58, 11, 59, 10,  9, 56, 60, 13, 14, 63, 15, 62, 61, 12,
+	61, 12, 15, 62, 14, 63, 60, 13,  9, 56, 59, 10, 58, 11,  8, 57,
+	62, 15, 12, 61, 13, 60, 63, 14, 10, 59, 56,  9, 57,  8, 11, 58,
+	11, 58, 57,  8, 56,  9, 10, 59, 63, 14, 13, 60, 12, 61, 62, 15,
+
+	31, 46, 45, 28, 44, 29, 30, 47, 43, 26, 25, 40, 24, 41, 42, 27,
+	42, 27, 24, 41, 25, 40, 43, 26, 30, 47, 44, 29, 45, 28, 31, 46,
+	41, 24, 27, 42, 26, 43, 40, 25, 29, 44, 47, 30, 46, 31, 28, 45,
+	28, 45, 46, 31, 47, 30, 29, 44, 40, 25, 26, 43, 27, 42, 41, 24,
+
+	40, 25, 26, 43, 27, 42, 41, 24, 28, 45, 46, 31, 47, 30, 29, 44,
+	29, 44, 47, 30, 46, 31, 28, 45, 41, 24, 27, 42, 26, 43, 40, 25,
+	30, 47, 44, 29, 45, 28, 31, 46, 42, 27, 24, 41, 25, 40, 43, 26,
+	43, 26, 25, 40, 24, 41, 42, 27, 31, 46, 45, 28, 44, 29, 30, 47
+    }
+};
+
+/* Table to extract the lower 4 bits from first hamm24/18
+   encoded byte (P4 D4 D3 D2 P3 D1 P2 P1) */
+static const int8_t
+_vbi3_hamm24_val [128] = {
+	 0,  0,  0,  0,  1,  1,  1,  1,  0,  0,  0,  0,  1,  1,  1,  1,
+	 2,  2,  2,  2,  3,  3,  3,  3,  2,  2,  2,  2,  3,  3,  3,  3,
+	 4,  4,  4,  4,  5,  5,  5,  5,  4,  4,  4,  4,  5,  5,  5,  5,
+	 6,  6,  6,  6,  7,  7,  7,  7,  6,  6,  6,  6,  7,  7,  7,  7,
+
+	 8,  8,  8,  8,  9,  9,  9,  9,  8,  8,  8,  8,  9,  9,  9,  9,
+	10, 10, 10, 10, 11, 11, 11, 11, 10, 10, 10, 10, 11, 11, 11, 11,
+	12, 12, 12, 12, 13, 13, 13, 13, 12, 12, 12, 12, 13, 13, 13, 13,
+	14, 14, 14, 14, 15, 15, 15, 15, 14, 14, 14, 14, 15, 15, 15, 15
+};
+
+/* Correction of single bit error in decoded word,
+   according to test A ... F in table vbi3_hamm24_inv_tst.
+   MSB indicates double bit error. */
+static const int32_t
+_vbi3_hamm24_corr [64] = {
+	0x00000000, 0x80000000, 0x80000000, 0x80000000,
+	0x80000000, 0x80000000, 0x80000000, 0x80000000,
+	0x80000000, 0x80000000, 0x80000000, 0x80000000,
+	0x80000000, 0x80000000, 0x80000000, 0x80000000,
+
+	0x80000000, 0x80000000, 0x80000000, 0x80000000,
+	0x80000000, 0x80000000, 0x80000000, 0x80000000,
+	0x80000000, 0x80000000, 0x80000000, 0x80000000,
+	0x80000000, 0x80000000, 0x80000000, 0x80000000,
+
+	0x00000000, 0x00000000, 0x00000000, 0x00000001,
+	0x00000000, 0x00000002, 0x00000004, 0x00000008,
+	0x00000000, 0x00000010, 0x00000020, 0x00000040,
+	0x00000080, 0x00000100, 0x00000200, 0x00000400,
+
+	0x00000000, 0x00000800, 0x00001000, 0x00002000,
+	0x00004000, 0x00008000, 0x00010000, 0x00020000,
+	0x80000000, 0x80000000, 0x80000000, 0x80000000,
+	0x80000000, 0x80000000, 0x80000000, 0x80000000,
+};
+
+/**
+ * @ingroup Error
+ * @param p Pointer to a Hamming 24/18 protected 24 bit word,
+ *   last significant byte first, lsb first transmitted.
+ * 
+ * Decodes a Hamming 24/18 protected byte triplet
+ * as specified in ETS 300 706, Section 8.3.
+ * 
+ * @return
+ * Triplet data bits D18 [msb] ... D1 [lsb] or a negative value
+ * if the triplet contained incorrectable errors.
+ */
+int
+vbi3_unham24p			(const uint8_t *	p)
+{
+	int e = _vbi3_hamm24_inv_par[0][p[0]]
+		^ _vbi3_hamm24_inv_par[1][p[1]]
+		^ _vbi3_hamm24_inv_par[2][p[2]];
+
+	int x = _vbi3_hamm24_val[p[0] & 127]
+		+ (p[1] & 127) * 16
+		+ (p[2] & 127) * 2048;
+
+	return x ^ (int) _vbi3_hamm24_corr[e];
+}
diff -Naur osdteletext-0.8.3-orig/hamm.h osdteletext-0.8.3/hamm.h
--- osdteletext-0.8.3-orig/hamm.h	1970-01-01 01:00:00.000000000 +0100
+++ osdteletext-0.8.3/hamm.h	2009-12-18 14:15:16.351481790 +0100
@@ -0,0 +1,205 @@
+/*
+ *  libzvbi - Error correction functions
+ *
+ *  Copyright (C) 2001, 2002, 2003, 2004 Michael H. Schimek
+ *
+ *  Based on code from AleVT 1.5.1
+ *  Copyright (C) 1998, 1999 Edgar Toernig <froese@gmx.de>
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+/* $Id: hamm.h,v 1.16 2005/06/28 01:00:22 mschimek Exp $ */
+
+#ifndef __ZVBI3_HAMM_H__
+#define __ZVBI3_HAMM_H__
+
+#include <inttypes.h>		/* uintN_t */
+#include "macros.h"
+
+VBI3_BEGIN_DECLS
+
+extern const uint8_t		_vbi3_bit_reverse [256];
+extern const uint8_t		_vbi3_hamm8_fwd [16];
+extern const int8_t		_vbi3_hamm8_inv [256];
+extern const int8_t		_vbi3_hamm24_inv_par [3][256];
+
+/**
+ * @addtogroup Error Error correction functions
+ * @ingroup Raw
+ * @brief Helper functions to decode sliced VBI data.
+ * @{
+ */
+
+/**
+ * @param c Unsigned byte.
+ * 
+ * Reverses the bits of the argument.
+ * 
+ * @returns
+ * Data bits 0 [msb] ... 7 [lsb].
+ */
+vbi3_inline unsigned int
+vbi3_rev8			(unsigned int		c)
+{
+	return _vbi3_bit_reverse[(uint8_t) c];
+}
+
+/**
+ * @param c Unsigned 16 bit word.
+ * 
+ * Reverses the bits of the argument.
+ * 
+ * @returns
+ * Data bits 0 [msb] ... 15 [lsb].
+ */
+vbi3_inline unsigned int
+vbi3_rev16			(unsigned int		c)
+{
+	return _vbi3_bit_reverse[(uint8_t) c] * 256
+		+ _vbi3_bit_reverse[(uint8_t)(c >> 8)];
+}
+
+/**
+ * @param p Pointer to a 16 bit word, last significant
+ *   byte first.
+ * 
+ * Reverses the bits of the argument.
+ * 
+ * @returns
+ * Data bits 0 [msb] ... 15 [lsb].
+ */
+vbi3_inline unsigned int
+vbi3_rev16p			(const uint8_t *	p)
+{
+	return _vbi3_bit_reverse[p[0]] * 256
+		+ _vbi3_bit_reverse[p[1]];
+}
+
+/**
+ * @param c Unsigned byte.
+ *
+ * @returns
+ * Changes the most significant bit of the byte
+ * to make the number of set bits odd.
+ */
+vbi3_inline unsigned int
+vbi3_par8			(unsigned int		c)
+{
+	c &= 255;
+
+	/* if 0 == (inv_par[] & 32) change bit 7 of c. */
+	c ^= 128 & ~(_vbi3_hamm24_inv_par[0][c] << 2);
+
+	return c;
+}
+
+/**
+ * @param c Unsigned byte. 
+ * 
+ * @returns
+ * If the byte has odd parity (sum of bits modulo 2 is 1) the
+ * byte AND 127, otherwise a negative value.
+ */
+vbi3_inline int
+vbi3_unpar8			(unsigned int		c)
+{
+#ifdef __GNUC__
+#if #cpu (i686)
+	int r = c & 127;
+
+	/* This saves cache flushes and an explicit branch. */
+	__asm__ (" testb	%1,%1\n"
+		 " cmovp	%2,%0\n"
+		 : "+&a" (r) : "c" (c), "rm" (-1));
+	return r;
+#endif
+#endif
+	if (_vbi3_hamm24_inv_par[0][(uint8_t) c] & 32) {
+		return c & 127;
+	} else {
+		/* The idea is to OR results together to find a parity
+		   error in a sequence, rather than a test and branch on
+		   each byte. */
+		return -1;
+	}
+}
+
+extern void
+vbi3_par				(uint8_t *		p,
+				 unsigned long		n);
+extern int
+vbi3_unpar			(uint8_t *		p,
+				 unsigned long		n);
+
+/**
+ * @param c Integer between 0 ... 15.
+ * 
+ * Encodes a nibble with Hamming 8/4 protection
+ * as specified in EN 300 706, Section 8.2.
+ * 
+ * @returns
+ * Hamming encoded unsigned byte, lsb first transmitted.
+ */
+vbi3_inline unsigned int
+vbi3_ham8			(unsigned int		c)
+{
+	return _vbi3_hamm8_fwd[c & 15];
+}
+
+/**
+ * @param c Hamming 8/4 protected byte, lsb first transmitted.
+ * 
+ * Decodes a Hamming 8/4 protected byte
+ * as specified in EN 300 706, Section 8.2.
+ * 
+ * @returns
+ * Data bits (D4 [msb] ... D1 [lsb]) or a negative
+ * value if the byte contained incorrectable errors.
+ */
+vbi3_inline int
+vbi3_unham8			(unsigned int		c)
+{
+	return _vbi3_hamm8_inv[(uint8_t) c];
+}
+
+/**
+ * @param p Pointer to a Hamming 8/4 protected 16 bit word,
+ *   last significant byte first, lsb first transmitted.
+ * 
+ * Decodes a Hamming 8/4 protected byte pair
+ * as specified in EN 300 706, Section 8.2.
+ * 
+ * @returns
+ * Data bits D4 [msb] ... D1 of first byte and D4 ... D1 [lsb]
+ * of second byte, or a negative value if any of the bytes
+ * contained incorrectable errors.
+ */
+vbi3_inline int
+vbi3_unham16p			(const uint8_t *	p)
+{
+	return ((int) _vbi3_hamm8_inv[p[0]])
+	  | (((int) _vbi3_hamm8_inv[p[1]]) << 4);
+}
+
+extern int
+vbi3_unham24p			(const uint8_t *	p)
+  __attribute__ ((_vbi3_pure));
+
+/** @} */
+
+VBI3_END_DECLS
+
+#endif /* __ZVBI3_HAMM_H__ */
diff -Naur osdteletext-0.8.3-orig/HISTORY osdteletext-0.8.3/HISTORY
--- osdteletext-0.8.3-orig/HISTORY	2009-12-11 12:02:42.876165129 +0100
+++ osdteletext-0.8.3/HISTORY	2009-12-18 14:14:40.235484295 +0100
@@ -1,6 +1,27 @@
 VDR Plugin 'osdteletext' Revision History
 -----------------------------------------
 
+20xx-xx-xx: version x.x.x
+- Implemented Level 1.5 decoder for diacritical marks (thanks to zjuanma).
+  At the moment it's only for some spanish characters, but is ready for fast
+  implementation in other languages.
+  Enhanced Teletext Specification:
+  http://www.themm.net/~mihu/linux/saa7146/specs/ets_300706e01p.pdf
+- Changes to work with special VDR version for Siemens Gigaset (thanks to HaPe)
+- Backward compatibility to VDR 1.3.19 based in EPGSearch (thx to Bittor Corl)
+  In VDR < 1.5.7 the translation is built from the po files calling to:
+    make generate-i18n
+  from osdteletext's source directory (this calls buildutil/pot2i18n.pl which
+  may need to install Locale::PO in the pearl cpan shell)
+- Updated Spanish translation provided by Bittor Corl
+- Updated Italian translation provided by Diego Pierotto (Closes #151)
+- Fix valid page number check in TeletextBrowser::ExecuteAction (Closes #154)
+- Fixed possible segfault (Closes #179) - (Thx to Manuel Reimer)
+- Added setup option to disable maine menu entry (Closes #149)
+  (Thx to Manuel Reimer!)
+- Added command line option to enable storing TopText pages, which is
+  now disabled by default (References #177) (Thx to Andreas Brachold!)
+
 2009-06-02: version 0.8.3
 - Updated Ukrainian translation provided by Yarema P. aka Knedlyk (Closes #133)
 
diff -Naur osdteletext-0.8.3-orig/i18n.c osdteletext-0.8.3/i18n.c
--- osdteletext-0.8.3-orig/i18n.c	1970-01-01 01:00:00.000000000 +0100
+++ osdteletext-0.8.3/i18n.c	2009-12-18 14:15:14.651500134 +0100
@@ -0,0 +1,16 @@
+/*
+ * i18n.c: Internationalization
+ *
+ * See the README file for copyright information and how to reach the author.
+ *
+ * $Id: i18n.c 1.3 2002/06/23 13:05:59 kls Exp $
+ */
+
+#include <vdr/plugin.h>
+
+#if APIVERSNUM < 10507
+
+#include "i18n.h"
+#include "i18n-generated.h"
+
+#endif
diff -Naur osdteletext-0.8.3-orig/i18n-generated.h osdteletext-0.8.3/i18n-generated.h
--- osdteletext-0.8.3-orig/i18n-generated.h	1970-01-01 01:00:00.000000000 +0100
+++ osdteletext-0.8.3/i18n-generated.h	2009-12-18 14:15:16.351481790 +0100
@@ -0,0 +1,715 @@
+/*
+  	WARNING: automatically generated content. Changes will get lost!
+
+    If this file is 'i18n-generated.h' then it *really* is automatically
+	generated.
+    If this file is 'i18n-template.h' then it is the base for the
+    autogeneration of the other file.
+
+*/
+
+const tI18nPhrase Phrases[] = {
+// START I18N - automatically generated by pot2i18n.pl
+  { "Channel (press OK): ",
+    "Sender (OK drücken): ",
+    "",
+    "Canale (premi OK): ",
+    "",
+    "Sender (Prima OK): ",
+    "Chaine (Appuyer sur OK): ",
+    "",
+    "Kanava (paina OK):",
+    "",
+    "Canal (pulse OK):",
+    "",
+    "",
+    "",
+    "",
+    "Canal (premi OK):",
+#if VDRVERSNUM >= 10302
+    "ºÐÝÐÛ (½ÐÖÜØâÕ ¾º)",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Page",
+    "Seite",
+    "",
+    "Pagina",
+    "",
+    "Página",
+    "Page",
+    "",
+    "Sivua",
+    "",
+    "Página",
+    "",
+    "",
+    "",
+    "",
+    "Pàgina",
+#if VDRVERSNUM >= 10302
+    "ÁâàÐÝØæÐ",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "not found until now, searching",
+    "nicht gefunden",
+    "",
+    "non trovata",
+    "",
+    "Não encontrado",
+    "pas trouvÃ©",
+    "",
+    "ei lÃ¶ydy",
+    "",
+    "no encontrada todavía, buscando ...",
+    "",
+    "",
+    "",
+    "",
+    "no trobada",
+#if VDRVERSNUM >= 10302
+    "ÝÕ ÝÐÙÔÕÝÐ",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Displays teletext on the OSD",
+    "Zeigt den Videotext auf dem OSD an",
+    "",
+    "Mostra il teletext in OSD",
+    "",
+    "Mostra o teletexto no OSD",
+    "Affiche le tÃ©lÃ©texte sur l'OSD",
+    "",
+    "Teksti-TV (OSD)",
+    "",
+    "Muestra el teletexto en el OSD",
+    "",
+    "",
+    "",
+    "",
+    "Visualitza el teletext en l'OSD",
+#if VDRVERSNUM >= 10302
+    "¿ÞÚÐ× âÕÛÕâÕÚáâÐ Ò OSD",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Teletext",
+    "Videotext",
+    "",
+    "Teletext",
+    "",
+    "Teletexto",
+    "Teletexte",
+    "",
+    "Teksti-TV",
+    "",
+    "Teletexto",
+    "",
+    "",
+    "",
+    "",
+    "Teletext",
+#if VDRVERSNUM >= 10302
+    "ÂÕÛÕâÕÚáâ",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Zoom",
+    "Vergrößern",
+    "",
+    "Ingrandisci",
+    "",
+    "Zoom",
+    "Zoom",
+    "",
+    "Suurenna",
+    "",
+    "Zoom",
+    "",
+    "",
+    "",
+    "",
+    "Zoom",
+#if VDRVERSNUM >= 10302
+    "ãÒÕÛØçØâì",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Half page",
+    "Halbe Seite",
+    "",
+    "MetÃ  pagina",
+    "",
+    "Meia Página",
+    "Demi-Page",
+    "",
+    "Puolikas sivu",
+    "",
+    "Media página",
+    "",
+    "",
+    "",
+    "",
+    "Mitja pàgina",
+#if VDRVERSNUM >= 10302
+    "ßÞÛ-áâàÐÝØæë",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Change channel",
+    "Kanal wechseln",
+    "",
+    "Cambia canale",
+    "",
+    "Mudar canal",
+    "Changer la chaÃ®ne",
+    "",
+    "Vaihda kanavaa",
+    "",
+    "Cambiar canal",
+    "",
+    "",
+    "",
+    "",
+    "Canvi cadena",
+#if VDRVERSNUM >= 10302
+    "ßÕàÕÚÛîçØâì ÚÐÝÐÛ",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Switch background",
+    "Hintergrund ändern",
+    "",
+    "Cambia sfondo",
+    "",
+    "Mudar fundo",
+    "Change le fond d'Ã©cran",
+    "",
+    "Vaihda tausta",
+    "",
+    "Cambiar el fondo",
+    "",
+    "",
+    "",
+    "",
+    "Canvia el fons",
+#if VDRVERSNUM >= 10302
+    "¿ÕàÕÚÛîçØâì äÞÝ",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Jump to...",
+    "Springe zu...",
+    "",
+    "Vai a...",
+    "",
+    "Ir para",
+    "Aller Ã ...",
+    "",
+    "Siirry sivulle...",
+    "",
+    "Saltar a...",
+    "",
+    "",
+    "",
+    "",
+    "Salta a...",
+#if VDRVERSNUM >= 10302
+    "ßÕàÕÙâØ Ú...",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Background transparency",
+    "Hintergrund-Transparenz",
+    "",
+    "Trasparenza sfondo",
+    "",
+    "Transparência do Fundo",
+    "Fond transparent",
+    "",
+    "Taustan lÃ¤pinÃ¤kyvyys",
+    "",
+    "Transparencia del fondo",
+    "",
+    "",
+    "",
+    "",
+    "Transparència del fons",
+#if VDRVERSNUM >= 10302
+    "¿àÞ×àÐçÝÞáâì äÞÝÐ",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Show clock",
+    "Uhr anzeigen",
+    "",
+    "Mostra orologio",
+    "",
+    "Mostrar Relógio",
+    "Afficher l'heure",
+    "",
+    "NÃ¤ytÃ¤ kello",
+    "",
+    "Mostrar la hora",
+    "",
+    "",
+    "",
+    "",
+    "Visualitza l'hora",
+#if VDRVERSNUM >= 10302
+    "¿ÞÚÐ×ëÒÐâì çÐáë",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Auto-update pages",
+    "Seiten aktualisieren",
+    "",
+    "Aggiorn. automatico pagine",
+    "",
+    "Auto actualizar páginas",
+    "Mise Ã  jour des pages",
+    "",
+    "Automaattinen sivupÃ¤ivitys",
+    "",
+    "Actualización páginas automática",
+    "",
+    "",
+    "",
+    "",
+    "Actualització pàgines automàtica",
+#if VDRVERSNUM >= 10302
+    "°ÒâÞÞÑÝÞÒÛÕÝØÕ áâàÐÝØæ",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "OSD height",
+    "OSD-Höhe",
+    "",
+    "Altezza OSD",
+    "",
+    "Altura do OSD",
+    "Hauteur OSD",
+    "",
+    "Korkeus",
+    "",
+    "Altura OSD",
+    "",
+    "",
+    "",
+    "",
+    "Altura OSD",
+#if VDRVERSNUM >= 10302
+    "²ëáÞâÐ ÜÕÝî",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "OSD width",
+    "OSD-Breite",
+    "",
+    "Larghezza OSD",
+    "",
+    "Largura do OSD",
+    "Largeur OSD",
+    "",
+    "Leveys",
+    "",
+    "Anchura OSD",
+    "",
+    "",
+    "",
+    "",
+    "Amplària OSD",
+#if VDRVERSNUM >= 10302
+    "ÈØàØÝÐ ÜÕÝî",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "OSD horizontal align",
+    "OSD horizontale Anordnung",
+    "",
+    "Allineamento orizzontale OSD",
+    "",
+    "Alinhamento Horizontal do OSD",
+    "Alignement horizontal de l'OSD",
+    "",
+    "Pystykeskitys",
+    "",
+    "OSD alineación horizontal",
+    "",
+    "",
+    "",
+    "",
+    "",
+#if VDRVERSNUM >= 10302
+    "³ÞàØ×ÞÝâÐÛìÝÞÕ ßÞÛÞÖÕÝØÕ OSD",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "OSD vertical align",
+    "OSD vertikale Anordnung",
+    "",
+    "Allineamento verticale OSD",
+    "",
+    "Alinhamento Vertical do OSD",
+    "Alignement vertical de l'OSD",
+    "",
+    "Vaakakeskitys",
+    "",
+    "OSD alineación vertical",
+    "",
+    "",
+    "",
+    "",
+    "",
+#if VDRVERSNUM >= 10302
+    "²ÕàâØÚÐÛìÝÞÕ ßÞÛÞÖÕÝØÕ OSD",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Hide mainmenu entry",
+    "Hauptmenüeintrag verstecken",
+    "",
+    "",
+    "",
+    "",
+    "",
+    "",
+    "Piilota valinta pÃ¤Ã¤valikosta",
+    "",
+    "Ocultar entrada del menú principal",
+    "",
+    "",
+    "",
+    "",
+    "",
+#if VDRVERSNUM >= 10302
+    "",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "Key bindings",
+    "Tastenzuweisung",
+    "",
+    "Tasti associati",
+    "",
+    "Tecla alocada",
+    "Attribution des touches",
+    "",
+    "NÃ¤ppÃ¤intoiminnot",
+    "",
+    "Asignación de botones",
+    "",
+    "",
+    "",
+    "",
+    "",
+#if VDRVERSNUM >= 10302
+    "¿àØÒï×ÚÐ ÚÝÞßÞÚ",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+  { "  Page number",
+    "  Seitenzahl",
+    "",
+    "  Numero pagina",
+    "",
+    "  Número de Página",
+    "  Nombre de pages",
+    "",
+    "  Sivunumero",
+    "",
+    "  Número de página",
+    "",
+    "",
+    "",
+    "",
+    "  Nombre de pàgina",
+#if VDRVERSNUM >= 10302
+    "  ½ÞÜÕà áâàÐÝØæë",
+#endif
+#if VDRVERSNUM >= 10307
+    "",
+#endif
+#if VDRVERSNUM >= 10313
+    "",
+#endif
+#if VDRVERSNUM >= 10316
+    "",
+#endif
+#if VDRVERSNUM >= 10342
+    "",
+#endif
+#if VDRVERSNUM >= 10502
+    "",
+#endif
+  },
+// END I18N - automatically generated by pot2i18n.pl
+  { NULL }
+};
diff -Naur osdteletext-0.8.3-orig/i18n.h osdteletext-0.8.3/i18n.h
--- osdteletext-0.8.3-orig/i18n.h	1970-01-01 01:00:00.000000000 +0100
+++ osdteletext-0.8.3/i18n.h	2009-12-18 14:15:16.356345069 +0100
@@ -0,0 +1,23 @@
+/*
+ * i18n.h: Internationalization
+ *
+ * See the README file for copyright information and how to reach the author.
+ *
+ * $Id: i18n.h 1.2 2002/05/11 14:48:16 kls Exp $
+ */
+
+#ifndef _I18N__H
+#define _I18N__H
+
+#include <vdr/i18n.h>
+
+#if APIVERSNUM < 10507
+extern const tI18nPhrase Phrases[];
+#define trNOOP(s) (s)
+#endif
+
+#if APIVERSNUM < 10509
+#define trVDR(s) tr(s)
+#endif
+
+#endif //_I18N__H
diff -Naur osdteletext-0.8.3-orig/i18n-template.h osdteletext-0.8.3/i18n-template.h
--- osdteletext-0.8.3-orig/i18n-template.h	1970-01-01 01:00:00.000000000 +0100
+++ osdteletext-0.8.3/i18n-template.h	2009-12-18 14:15:16.356345069 +0100
@@ -0,0 +1,15 @@
+/*
+  	WARNING: automatically generated content. Changes will get lost!
+
+    If this file is 'i18n-generated.h' then it *really* is automatically
+	generated.
+    If this file is 'i18n-template.h' then it is the base for the
+    autogeneration of the other file.
+
+*/
+
+const tI18nPhrase Phrases[] = {
+// START I18N
+// END I18N
+  { NULL }
+};
diff -Naur osdteletext-0.8.3-orig/macros.h osdteletext-0.8.3/macros.h
--- osdteletext-0.8.3-orig/macros.h	1970-01-01 01:00:00.000000000 +0100
+++ osdteletext-0.8.3/macros.h	2009-12-18 14:15:16.356345069 +0100
@@ -0,0 +1,99 @@
+/*
+ *  libzvbi - Useful macros
+ *
+ *  Copyright (C) 2002, 2003, 2004 Michael H. Schimek
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+/* $Id: macros.h,v 1.5 2006/03/21 19:01:24 mschimek Exp $ */
+
+#ifndef __ZVBI3_MACROS_H__
+#define __ZVBI3_MACROS_H__
+
+#ifdef __cplusplus
+#  define VBI3_BEGIN_DECLS extern "C" {
+#  define VBI3_END_DECLS }
+#else
+#  define VBI3_BEGIN_DECLS
+#  define VBI3_END_DECLS
+#endif
+
+VBI3_BEGIN_DECLS
+
+#if __GNUC__ >= 4
+#  define _vbi3_sentinel sentinel(0)
+#else
+#  define _vbi3_sentinel
+#  define __restrict__
+#endif
+
+#if (__GNUC__ == 3 && __GNUC_MINOR__ >= 3) || __GNUC__ >= 4
+#  define _vbi3_nonnull(args...) nonnull(args)
+#else
+#  define _vbi3_nonnull(args...)
+#endif
+
+#if __GNUC__ >= 3
+#  define _vbi3_pure pure
+#  define _vbi3_alloc malloc
+#else
+#  define _vbi3_pure
+#  define _vbi3_alloc
+#endif
+
+#if __GNUC__ >= 2
+#  define vbi3_inline static __inline__
+#else
+#  define vbi3_inline static
+#  define __attribute__(args...)
+#endif
+
+/**
+ * @ingroup Basic
+ * @name Boolean type
+ * @{
+ */
+#ifndef TRUE
+#  define TRUE 1
+#endif
+#ifndef FALSE
+#  define FALSE 0
+#endif
+
+typedef int vbi3_bool;
+/** @} */
+
+#ifndef NULL
+#  ifdef __cplusplus
+#    define NULL (0L)
+#  else
+#    define NULL ((void *) 0)
+#  endif
+#endif
+
+/** XXX Document me - for variadic funcs.
+  (this is a pointer not int to take advantage of
+  __attribute__((sentinel))). */
+#define VBI3_END ((void *) 0)
+
+typedef void
+vbi3_lock_fn			(void *			user_data);
+typedef void
+vbi3_unlock_fn			(void *			user_data);
+
+VBI3_END_DECLS
+
+#endif /* __ZVBI3_MACROS_H__ */
diff -Naur osdteletext-0.8.3-orig/Makefile osdteletext-0.8.3/Makefile
--- osdteletext-0.8.3-orig/Makefile	2009-12-11 12:02:42.876165129 +0100
+++ osdteletext-0.8.3/Makefile	2009-12-18 14:14:40.235484295 +0100
@@ -16,12 +16,12 @@
 ### The C++ compiler and options:
 
 OPTLEVEL ?= 2
-CXXFLAGS = -O$(OPTLEVEL) -g -Wall -Woverloaded-virtual -fPIC -DPIC
+CXXFLAGS = -O$(OPTLEVEL) -g -Wall -Werror -Woverloaded-virtual -fPIC -DPIC
 
 ### The directory environment:
 
-VDRDIR = ../../..
-LIBDIR = ../../lib
+VDRDIR ?= ../../..
+LIBDIR ?= ../../lib
 TMPDIR = /tmp
 
 ### Allow user defined options to overwrite defaults:
@@ -41,11 +41,15 @@
 
 INCLUDES += -I$(VDRDIR)/include
 
-DEFINES += -DPLUGIN_NAME_I18N='"$(PLUGIN)"' -D_GNU_SOURCE
+DEFINES += -DPLUGIN_NAME_I18N='"$(PLUGIN)"' -D_GNU_SOURCE -DTXT_CHARSIZE=2
+
+# Compiled for VDR-M7x0 Siemens Gigaset from open7x0.org
+# Comment following line in other cases
+DEFINES += -DVDR_M7x0_VERSION
 
 ### The object files (add further files here):
 
-OBJS = $(PLUGIN).o menu.o txtfont.o txtrecv.o txtrender.o displaybase.o display.o
+OBJS = $(PLUGIN).o menu.o txtfont.o i18n.o txtrecv.o txtrender.o displaybase.o display.o hamm.o
 
 ### Implicit rules:
 
@@ -74,8 +78,8 @@
 %.mo: %.po
 	msgfmt -c -o $@ $<
 
-$(I18Npot): $(wildcard *.c)
-	xgettext -C -cTRANSLATORS --no-wrap --no-location -k -ktr -ktrNOOP --msgid-bugs-address='<nobody@nowhere.org>' -o $@ $^
+$(I18Npot): $(wildcard *.[ch])
+	xgettext -C -cTRANSLATORS --no-wrap --no-location -k -ktr -ktrNOOP --msgid-bugs-address='<nobody@nowhere.org>' -o $@ $(wildcard *.[ch])
 
 %.po: $(I18Npot)
 	msgmerge -U --no-wrap --no-location --backup=none -q $@ $<
@@ -86,7 +90,11 @@
 	cp $< $@
 
 .PHONY: i18n
-i18n: $(I18Nmsgs)
+i18n: $(I18Nmsgs) $(I18Npot)
+
+generate-i18n: i18n-template.h $(I18Npot) $(I18Npo) buildutil/pot2i18n.pl
+	@chmod +x buildutil/pot2i18n.pl
+	buildutil/pot2i18n.pl $(I18Npot) i18n-template.h > i18n-generated.h
 
 ### Targets:
 
@@ -96,7 +104,7 @@
 	$(CXX) $(CXXFLAGS) -shared $(OBJS) -o $@
 	@cp --remove-destination $@ $(LIBDIR)/$@.$(APIVERSION)
 
-dist: clean
+dist: generate-i18n clean
 	@-rm -rf $(TMPDIR)/$(ARCHIVE)
 	@mkdir $(TMPDIR)/$(ARCHIVE)
 	@cp -a * $(TMPDIR)/$(ARCHIVE)
@@ -106,7 +114,7 @@
 
 clean:
 	@-rm -f $(PODIR)/*.mo $(PODIR)/*.pot
-	@-rm -f $(OBJS) $(DEPFILE) *.so *.tgz core* *~
+	@-rm -f $(OBJS) $(DEPFILE) *.so *.tgz core* *~ pod2*.tmp
 
 install:
 	@install -d ../../man
diff -Naur osdteletext-0.8.3-orig/menu.c osdteletext-0.8.3/menu.c
--- osdteletext-0.8.3-orig/menu.c	2009-12-11 12:02:42.867827135 +0100
+++ osdteletext-0.8.3/menu.c	2009-12-18 14:15:14.651500134 +0100
@@ -12,9 +12,11 @@
 #include <time.h>
     
 #include <vdr/interface.h>
+#include <vdr/i18n.h>
 #include <vdr/config.h>
 
 #include "menu.h"
+#include "i18n.h"
 #include "display.h"
 #include "setup.h"
 #include "txtrecv.h"
@@ -43,7 +45,8 @@
 TeletextBrowser* TeletextBrowser::self=0;
 
 
-TeletextBrowser::TeletextBrowser(cTxtStatus *txtSt) {
+TeletextBrowser::TeletextBrowser(cTxtStatus *txtSt,Storage *s) {
+   storage = s;
    cursorPos=0;
    pageFound=true;
    selectingChannel=false;
@@ -319,7 +322,7 @@
                //This means, we convert the number to what it would be if the string
                //had been parsed with hexadecimal base.
                int pageNr=PSEUDO_HEX_TO_DECIMAL((int)e);
-               if (0x100<=pageNr<=0x899) {
+               if (0x100<=pageNr && pageNr<=0x899) {
                   if (selectingChannel) {
                       selectingChannel=false;
                       Display::ClearMessage();
@@ -524,11 +527,10 @@
 {
    StorageHandle fd;
    
-   Storage *s=Storage::instance();
-   if (!(fd=s->openForReading(PageID(channel, currentPage, currentSubPage), false)) )
+   if (!(fd=storage->openForReading(PageID(channel, currentPage, currentSubPage), false)) )
       return false;
 
-   s->close(fd);
+   storage->close(fd);
    return true;
 }
 
@@ -571,25 +573,24 @@
 //this is taken and adapted from the teletext plugin since it uses its data
 bool TeletextBrowser::DecodePage() {
    // Load the page and decodes it
-   unsigned char cache[40*24+12];
+   unsigned char cache[(40*24)*TXT_CHARSIZE+12];
    StorageHandle fd;
    // Take a look if there is a xxx-00 page
-   Storage *s=Storage::instance();
    if (currentSubPage==0) {
-      if ( !(fd=s->openForReading(PageID(channel, currentPage,currentSubPage), false)) ) {
+      if ( !(fd=storage->openForReading(PageID(channel, currentPage,currentSubPage), false)) ) {
          // There is no subpage 0 so look if there is subpage 1
          currentSubPage++;
          // Generate file string
       } else {
          // yes file exists
-         s->close(fd);
+         storage->close(fd);
       }
    }
    
-   if ( (fd=s->openForReading(PageID(channel, currentPage, currentSubPage), true)) )
+   if ( (fd=storage->openForReading(PageID(channel, currentPage, currentSubPage), true)) )
    {
-      s->read(cache,sizeof cache,fd); // Read full page data
-      s->close(fd);
+      storage->read(cache,sizeof cache,fd); // Read full page data
+      storage->close(fd);
       
       Display::HoldFlush();
       Display::ClearMessage();
@@ -604,7 +605,7 @@
       Display::HoldFlush();
       ShowPageNumber();
       char str[80];
-      snprintf(str,80, "%s %3x-%02x %s",tr("Page"),currentPage, currentSubPage,tr("not found"));
+      snprintf(str,80, "%s %3x-%02x %s",tr("Page"),currentPage, currentSubPage,tr("not found until now, searching"));
       Display::DrawMessage(str);
       Display::ReleaseFlush();
 
@@ -621,12 +622,11 @@
    
    CheckFirstSubPage(currentSubPage);
    
-   Storage *s=Storage::instance();
-   if ((fd=s->openForReading(PageID(channel, currentPage, currentSubPage), false)) ) {
-      uchar cache[960];
-      s->read(cache, 12, fd); //skip
-      s->read(cache, sizeof(cache), fd);
-      s->close(fd);
+   if ((fd=storage->openForReading(PageID(channel, currentPage, currentSubPage), false)) ) {
+      uchar cache[960*TXT_CHARSIZE];
+      storage->read(cache, 12, fd); //skip
+      storage->read(cache, sizeof(cache), fd);
+      storage->close(fd);
       memset(cache+12, 0, 8); //it seems that there the clock is transmitted, ignore changes
       for (uint i=0;i<sizeof(cache); i++)
          retSum+=cache[i];
@@ -656,6 +656,7 @@
    showClock=true;
    suspendReceiving=false;
    autoUpdatePage=true;
+   HideMainMenu=false;
    //OSDHeight+width default values given in Start()
    OSDHAlign=50;
    OSDVAlign=50;
diff -Naur osdteletext-0.8.3-orig/menu.h osdteletext-0.8.3/menu.h
--- osdteletext-0.8.3-orig/menu.h	2009-12-11 12:02:42.871615145 +0100
+++ osdteletext-0.8.3/menu.h	2009-12-18 14:15:16.356345069 +0100
@@ -24,7 +24,7 @@
 
 class TeletextBrowser : public cOsdObject {
 public:
-   TeletextBrowser(cTxtStatus *txtSt);
+   TeletextBrowser(cTxtStatus *txtSt,Storage *s);
    ~TeletextBrowser();
    void Show(void);
    static void ChannelSwitched(int ChannelNumber);
@@ -67,6 +67,7 @@
    static tChannelID channel;
    static int currentChannelNumber;
    static TeletextBrowser* self;
+   Storage *storage;
 private:
    void ChangeBackground();
 };
diff -Naur osdteletext-0.8.3-orig/osdteletext.c osdteletext-0.8.3/osdteletext.c
--- osdteletext-0.8.3-orig/osdteletext.c	2009-12-11 12:02:42.867827135 +0100
+++ osdteletext-0.8.3/osdteletext.c	2009-12-18 14:15:14.656306702 +0100
@@ -10,6 +10,7 @@
  ***************************************************************************/
 
 #include <vdr/plugin.h>
+#include <vdr/i18n.h>
 #include <vdr/keys.h>
 #include <vdr/config.h>
 
@@ -18,11 +19,12 @@
 using namespace std;
 
 #include "menu.h"
+#include "i18n.h"
 #include "txtrecv.h"
 #include "setup.h"
 
-#if defined(APIVERSNUM) && APIVERSNUM < 10600
-#error "VDR-1.6.0 API version or greater is required!"
+#if defined(APIVERSNUM) && APIVERSNUM < 10319
+#error "VDR-1.3.19 API version or greater is required!"
 #endif
 
 static const char *VERSION        = "0.8.3";
@@ -34,7 +36,11 @@
   // Add any member variables or functions you may need here.
   cTxtStatus *txtStatus;
   bool startReceiver;
+  bool storeTopText;
+  Storage *storage;
+  int maxStorage;
   void initTexts();
+  Storage::StorageSystem storageSystem;
 public:
   cPluginTeletextosd(void);
   virtual ~cPluginTeletextosd();
@@ -44,7 +50,7 @@
   virtual bool ProcessArgs(int argc, char *argv[]);
   virtual bool Start(void);
   virtual void Housekeeping(void);
-  virtual const char *MainMenuEntry(void) { return tr(MAINMENUENTRY); }
+  virtual const char *MainMenuEntry(void);
   virtual cOsdObject *MainMenuAction(void);
   virtual cMenuSetupPage *SetupMenu(void);
   virtual bool SetupParse(const char *Name, const char *Value);
@@ -96,7 +102,6 @@
 };*/
 
 
-
 cPluginTeletextosd::cPluginTeletextosd(void)
 {
   // Initialize any member variables here.
@@ -104,6 +109,12 @@
   // VDR OBJECTS TO EXIST OR PRODUCE ANY OUTPUT!
   txtStatus=0;
   startReceiver=true;
+  storage = NULL;
+#ifdef VDR_M7x0_VERSION
+  maxStorage=10;
+#else
+  maxStorage=-1;
+#endif
 }
 
 cPluginTeletextosd::~cPluginTeletextosd()
@@ -111,7 +122,10 @@
    // Clean up after yourself!
    if (txtStatus)
       delete txtStatus;
-   Storage::instance()->cleanUp();
+   if(storage) {
+     storage->cleanUp();
+     delete storage;
+   }
 }
 
 const char *cPluginTeletextosd::CommandLineHelp(void)
@@ -128,7 +142,8 @@
          "                               Choose \"legacy\" for the traditional\n"
          "                               one-file-per-page system.\n"
          "                               Default is \"packed\" for the \n"
-         "                               one-file-for-a-few-pages system.\n";
+         "                               one-file-for-a-few-pages system.\n"
+         "  -t,       --toptext          Store top text pages at cache. (unviewable pages)\n";
 }
 
 bool cPluginTeletextosd::ProcessArgs(int argc, char *argv[])
@@ -137,21 +152,21 @@
    static struct option long_options[] = {
        { "directory",    required_argument,       NULL, 'd' },
        { "max-cache",    required_argument,       NULL, 'n' },
-       { "cache-system",    required_argument,       NULL, 's' },
+       { "cache-system", required_argument,       NULL, 's' },
+       { "toptext",      no_argument,             NULL, 't' },
        { NULL }
        };
      
    int c;
-   int maxStorage=-1;
-   while ((c = getopt_long(argc, argv, "s:d:n:", long_options, NULL)) != -1) {
+   while ((c = getopt_long(argc, argv, "s:d:n:t", long_options, NULL)) != -1) {
         switch (c) {
           case 's': 
                     if (!optarg)
                        break;
                     if (strcasecmp(optarg, "legacy")==0)
-                       Storage::setSystem(Storage::StorageSystemLegacy);
+                       storageSystem = Storage::StorageSystemLegacy;
                     else if (strcasecmp(optarg, "packed")==0)
-                       Storage::setSystem(Storage::StorageSystemPacked);
+                       storageSystem = Storage::StorageSystemPacked;
                     break;
           case 'd': Storage::setRootDir(optarg);
                     break;
@@ -160,12 +175,10 @@
                        maxStorage=n;
                     }
                     break;
+          case 't': storeTopText=true;
+                    break;
         }
    }
-   //do this here because the option -s to change the storage system might be given
-   // after -n, and then -s would have no effect
-   if (maxStorage>=0)
-      Storage::instance()->setMaxStorage(maxStorage);
    return true;
 }
 
@@ -174,10 +187,11 @@
   // Start any background activities the plugin shall perform.
    //Clean any files which might be remaining from the last session, 
    //perhaps due to a crash they have not been deleted.
-   Storage::instance()->init();
+   storage = Storage::CreateInstance(storageSystem, maxStorage);
+
    initTexts();
    if (startReceiver)
-      txtStatus=new cTxtStatus();
+      txtStatus=new cTxtStatus(storeTopText, storage);
    if (ttSetup.OSDheight<=100)  ttSetup.OSDheight=Setup.OSDHeight;
    if (ttSetup.OSDwidth<=100)   ttSetup.OSDwidth=Setup.OSDWidth;
   
@@ -187,6 +201,9 @@
 void cPluginTeletextosd::initTexts() {
    if (cTeletextSetupPage::actionKeyNames)
       return;
+#if APIVERSNUM < 10507
+   RegisterI18n(Phrases);
+#endif
    //TODO: rewrite this in the xy[0].cd="fg"; form
    static const ActionKeyName st_actionKeyNames[] =
    {
@@ -220,10 +237,15 @@
   // Perform any cleanup or other regular tasks.
 }
 
+const char *cPluginTeletextosd::MainMenuEntry(void)
+{
+   return ttSetup.HideMainMenu ? 0 : tr(MAINMENUENTRY);
+}
+
 cOsdObject *cPluginTeletextosd::MainMenuAction(void)
 {
    // Perform the action when selected from the main VDR menu.
-   return new TeletextBrowser(txtStatus);
+   return new TeletextBrowser(txtStatus,storage);
 }
 
 cMenuSetupPage *cPluginTeletextosd::SetupMenu(void)
@@ -249,6 +271,7 @@
   else if (!strcasecmp(Name, "OSDHAlign")) ttSetup.OSDHAlign=atoi(Value);
   else if (!strcasecmp(Name, "OSDVAlign")) ttSetup.OSDVAlign=atoi(Value);
   else if (!strcasecmp(Name, "inactivityTimeout")) /*ttSetup.inactivityTimeout=atoi(Value)*/;
+  else if (!strcasecmp(Name, "HideMainMenu")) ttSetup.HideMainMenu=atoi(Value);
   else {
      for (int i=0;i<LastActionKey;i++) {
         if (!strcasecmp(Name, cTeletextSetupPage::actionKeyNames[i].internalName)) {
@@ -289,6 +312,7 @@
    ttSetup.OSDwidth=temp.OSDwidth;
    ttSetup.OSDHAlign=temp.OSDHAlign;
    ttSetup.OSDVAlign=temp.OSDVAlign;
+   ttSetup.HideMainMenu=temp.HideMainMenu;
    //ttSetup.inactivityTimeout=temp.inactivityTimeout;
    
    for (int i=0;i<LastActionKey;i++) {
@@ -303,6 +327,7 @@
    SetupStore("OSDwidth", ttSetup.OSDwidth);
    SetupStore("OSDHAlign", ttSetup.OSDHAlign);
    SetupStore("OSDVAlign", ttSetup.OSDVAlign);
+   SetupStore("HideMainMenu", ttSetup.HideMainMenu);
    //SetupStore("inactivityTimeout", ttSetup.inactivityTimeout);
 }
 
@@ -329,8 +354,9 @@
    temp.OSDwidth=ttSetup.OSDwidth;
    temp.OSDHAlign=ttSetup.OSDHAlign;
    temp.OSDVAlign=ttSetup.OSDVAlign;
+   temp.HideMainMenu=ttSetup.HideMainMenu;
    //temp.inactivityTimeout=ttSetup.inactivityTimeout;
-      
+
    Add(new cMenuEditIntItem(tr("Background transparency"), &tempConfiguredClrBackground, 0, 255)); 
    
    Add(new cMenuEditBoolItem(tr("Show clock"), &temp.showClock ));
@@ -344,6 +370,7 @@
    
    Add(new cMenuEditIntItem(tr("OSD horizontal align"), &temp.OSDHAlign, 0, 100));
    Add(new cMenuEditIntItem(tr("OSD vertical align"), &temp.OSDVAlign, 0, 100));
+   Add(new cMenuEditBoolItem(tr("Hide mainmenu entry"), &temp.HideMainMenu));
    
    //Using same string as VDR's setup menu
    //Add(new cMenuEditIntItem(tr("Setup.Miscellaneous$Min. user inactivity (min)"), &temp.inactivityTimeout));
diff -Naur osdteletext-0.8.3-orig/po/ca_ES.po osdteletext-0.8.3/po/ca_ES.po
--- osdteletext-0.8.3-orig/po/ca_ES.po	2009-12-11 12:02:42.859939675 +0100
+++ osdteletext-0.8.3/po/ca_ES.po	2009-12-17 19:13:32.000000000 +0100
@@ -1,5 +1,5 @@
 # VDR plugin language source file.
-# Copyright (C) 2007 Klaus Schmidinger <kls@cadsoft.de>
+# Copyright (C) 2007 Klaus Schmidinger <Klaus.Schmidinger@tvdr.de>
 # This file is distributed under the same license as the VDR package.
 # Marc Rovira Vall <tm05462@salleURL.edu>, 2003
 # Ramon Roca <ramon.roca@xcombo.com>, 2003
@@ -9,7 +9,7 @@
 msgstr ""
 "Project-Id-Version: VDR 1.5.7\n"
 "Report-Msgid-Bugs-To: <nobody@nowhere.org>\n"
-"POT-Creation-Date: 2008-12-20 10:45+0100\n"
+"POT-Creation-Date: 2009-10-21 19:27+0200\n"
 "PO-Revision-Date: 2008-05-04 15:33+0200\n"
 "Last-Translator: Jordi Vilà <jvila@tinet.org>\n"
 "Language-Team: Catalanian\n"
@@ -23,7 +23,7 @@
 msgid "Page"
 msgstr "Pàgina"
 
-msgid "not found"
+msgid "not found until now, searching"
 msgstr "no trobada"
 
 msgid "Displays teletext on the OSD"
@@ -68,6 +68,9 @@
 msgid "OSD vertical align"
 msgstr ""
 
+msgid "Hide mainmenu entry"
+msgstr ""
+
 msgid "Key bindings"
 msgstr ""
 
diff -Naur osdteletext-0.8.3-orig/po/de_DE.po osdteletext-0.8.3/po/de_DE.po
--- osdteletext-0.8.3-orig/po/de_DE.po	2009-12-11 12:02:42.864118411 +0100
+++ osdteletext-0.8.3/po/de_DE.po	2009-12-17 19:13:32.000000000 +0100
@@ -1,15 +1,15 @@
 # VDR plugin language source file.
-# Copyright (C) 2007 Klaus Schmidinger <kls@cadsoft.de>
+# Copyright (C) 2007 Klaus Schmidinger <Klaus.Schmidinger@tvdr.de>
 # This file is distributed under the same license as the VDR package.
-# Klaus Schmidinger <kls@cadsoft.de>, 2000
+# Klaus Schmidinger <Klaus.Schmidinger@tvdr.de>, 2000
 #
 msgid ""
 msgstr ""
 "Project-Id-Version: VDR 1.5.7\n"
 "Report-Msgid-Bugs-To: <nobody@nowhere.org>\n"
-"POT-Creation-Date: 2008-12-20 10:45+0100\n"
+"POT-Creation-Date: 2009-10-21 19:27+0200\n"
 "PO-Revision-Date: 2008-05-04 15:33+0200\n"
-"Last-Translator: Klaus Schmidinger <kls@cadsoft.de>\n"
+"Last-Translator: Klaus Schmidinger <Klaus.Schmidinger@tvdr.de>\n"
 "Language-Team: German\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=ISO-8859-15\n"
@@ -21,7 +21,7 @@
 msgid "Page"
 msgstr "Seite"
 
-msgid "not found"
+msgid "not found until now, searching"
 msgstr "nicht gefunden"
 
 msgid "Displays teletext on the OSD"
@@ -66,6 +66,9 @@
 msgid "OSD vertical align"
 msgstr "OSD vertikale Anordnung"
 
+msgid "Hide mainmenu entry"
+msgstr "Hauptmenüeintrag verstecken"
+
 msgid "Key bindings"
 msgstr "Tastenzuweisung"
 
diff -Naur osdteletext-0.8.3-orig/po/es_ES.po osdteletext-0.8.3/po/es_ES.po
--- osdteletext-0.8.3-orig/po/es_ES.po	2009-12-11 12:02:42.859939675 +0100
+++ osdteletext-0.8.3/po/es_ES.po	2009-12-17 19:13:32.000000000 +0100
@@ -1,15 +1,16 @@
 # VDR plugin language source file.
-# Copyright (C) 2007 Klaus Schmidinger <kls@cadsoft.de>
+# Copyright (C) 2007 Klaus Schmidinger <Klaus.Schmidinger@tvdr.de>
 # This file is distributed under the same license as the VDR package.
 # Ruben Nunez Francisco <ruben.nunez@tang-it.com>, 2002
+# Bittor Corl <bittor7x0 _at_ gmail.com>, 2009
 #
 msgid ""
 msgstr ""
 "Project-Id-Version: VDR 1.5.7\n"
 "Report-Msgid-Bugs-To: <nobody@nowhere.org>\n"
-"POT-Creation-Date: 2008-12-20 10:45+0100\n"
-"PO-Revision-Date: 2008-05-04 15:33+0200\n"
-"Last-Translator: Ruben Nunez Francisco <ruben.nunez@tang-it.com>\n"
+"POT-Creation-Date: 2009-10-21 19:27+0200\n"
+"PO-Revision-Date: 2009-10-07 20:05+0200\n"
+"Last-Translator: Bittor Corl <bittor7x0 _at_ gmail.com>\n"
 "Language-Team: Spanish\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=ISO-8859-15\n"
@@ -21,11 +22,11 @@
 msgid "Page"
 msgstr "Página"
 
-msgid "not found"
-msgstr "no encontrada"
+msgid "not found until now, searching"
+msgstr "no encontrada todavía, buscando ..."
 
 msgid "Displays teletext on the OSD"
-msgstr "Visualiza el teletexto en el OSD"
+msgstr "Muestra el teletexto en el OSD"
 
 msgid "Teletext"
 msgstr "Teletexto"
@@ -37,22 +38,22 @@
 msgstr "Media página"
 
 msgid "Change channel"
-msgstr "Cambio cadena"
+msgstr "Cambiar canal"
 
 msgid "Switch background"
-msgstr "Cambia el fondo"
+msgstr "Cambiar el fondo"
 
 msgid "Jump to..."
-msgstr "Salta a..."
+msgstr "Saltar a..."
 
 msgid "Background transparency"
 msgstr "Transparencia del fondo"
 
 msgid "Show clock"
-msgstr "Visualiza el reloj"
+msgstr "Mostrar la hora"
 
 msgid "Auto-update pages"
-msgstr ""
+msgstr "Actualización páginas automática"
 
 msgid "OSD height"
 msgstr "Altura OSD"
@@ -61,13 +62,16 @@
 msgstr "Anchura OSD"
 
 msgid "OSD horizontal align"
-msgstr ""
+msgstr "OSD alineación horizontal"
 
 msgid "OSD vertical align"
-msgstr ""
+msgstr "OSD alineación vertical"
+
+msgid "Hide mainmenu entry"
+msgstr "Ocultar entrada del menú principal"
 
 msgid "Key bindings"
-msgstr ""
+msgstr "Asignación de botones"
 
 msgid "  Page number"
 msgstr "  Número de página"
diff -Naur osdteletext-0.8.3-orig/po/fi_FI.po osdteletext-0.8.3/po/fi_FI.po
--- osdteletext-0.8.3-orig/po/fi_FI.po	2009-12-11 12:02:42.859939675 +0100
+++ osdteletext-0.8.3/po/fi_FI.po	2009-12-17 19:13:33.000000000 +0100
@@ -1,5 +1,5 @@
 # VDR plugin language source file.
-# Copyright (C) 2007 Klaus Schmidinger <kls@cadsoft.de>
+# Copyright (C) 2007 Klaus Schmidinger <Klaus.Schmidinger@tvdr.de>
 # This file is distributed under the same license as the VDR package.
 # Rolf Ahrenberg <rahrenbe@cc.hut.fi>, 2003
 #
@@ -7,7 +7,7 @@
 msgstr ""
 "Project-Id-Version: VDR 1.5.7\n"
 "Report-Msgid-Bugs-To: <nobody@nowhere.org>\n"
-"POT-Creation-Date: 2008-12-20 10:45+0100\n"
+"POT-Creation-Date: 2009-10-21 19:27+0200\n"
 "PO-Revision-Date: 2008-05-04 15:33+0200\n"
 "Last-Translator: Rolf Ahrenberg <rahrenbe@cc.hut.fi>\n"
 "Language-Team: Finnish\n"
@@ -21,7 +21,7 @@
 msgid "Page"
 msgstr "Sivua"
 
-msgid "not found"
+msgid "not found until now, searching"
 msgstr "ei lÃ¶ydy"
 
 msgid "Displays teletext on the OSD"
@@ -66,6 +66,9 @@
 msgid "OSD vertical align"
 msgstr "Vaakakeskitys"
 
+msgid "Hide mainmenu entry"
+msgstr "Piilota valinta pÃ¤Ã¤valikosta"
+
 msgid "Key bindings"
 msgstr "NÃ¤ppÃ¤intoiminnot"
 
diff -Naur osdteletext-0.8.3-orig/po/fr_FR.po osdteletext-0.8.3/po/fr_FR.po
--- osdteletext-0.8.3-orig/po/fr_FR.po	2009-12-11 12:02:42.864118411 +0100
+++ osdteletext-0.8.3/po/fr_FR.po	2009-12-17 19:13:33.000000000 +0100
@@ -1,5 +1,5 @@
 # VDR plugin language source file.
-# Copyright (C) 2007 Klaus Schmidinger <kls@cadsoft.de>
+# Copyright (C) 2007 Klaus Schmidinger <Klaus.Schmidinger@tvdr.de>
 # This file is distributed under the same license as the VDR package.
 # Jean-Claude Repetto <jc@repetto.org>, 2001
 # Olivier Jacques <jacquesolivier@hotmail.com>, 2003
@@ -10,7 +10,7 @@
 msgstr ""
 "Project-Id-Version: VDR 1.5.7\n"
 "Report-Msgid-Bugs-To: <nobody@nowhere.org>\n"
-"POT-Creation-Date: 2008-12-20 10:45+0100\n"
+"POT-Creation-Date: 2009-10-21 19:27+0200\n"
 "PO-Revision-Date: 2009-01-10 19:32+0100\n"
 "Last-Translator: Nival MichaÃ«l\n"
 "Language-Team: French\n"
@@ -24,7 +24,7 @@
 msgid "Page"
 msgstr "Page"
 
-msgid "not found"
+msgid "not found until now, searching"
 msgstr "pas trouvÃ©"
 
 msgid "Displays teletext on the OSD"
@@ -69,9 +69,11 @@
 msgid "OSD vertical align"
 msgstr "Alignement vertical de l'OSD"
 
+msgid "Hide mainmenu entry"
+msgstr ""
+
 msgid "Key bindings"
 msgstr "Attribution des touches"
 
 msgid "  Page number"
 msgstr "  Nombre de pages"
-
diff -Naur osdteletext-0.8.3-orig/po/it_IT.po osdteletext-0.8.3/po/it_IT.po
--- osdteletext-0.8.3-orig/po/it_IT.po	2009-12-11 12:02:42.859939675 +0100
+++ osdteletext-0.8.3/po/it_IT.po	2009-12-17 19:13:33.000000000 +0100
@@ -1,5 +1,5 @@
 # VDR plugin language source file.
-# Copyright (C) 2007 Klaus Schmidinger <kls@cadsoft.de>
+# Copyright (C) 2007 Klaus Schmidinger <Klaus.Schmidinger@tvdr.de>
 # This file is distributed under the same license as the VDR package.
 # Alberto Carraro <bertocar@tin.it>, 2001
 # Antonio Ospite <ospite@studenti.unina.it>, 2003
@@ -11,8 +11,8 @@
 msgstr ""
 "Project-Id-Version: VDR 1.5.7\n"
 "Report-Msgid-Bugs-To: <nobody@nowhere.org>\n"
-"POT-Creation-Date: 2008-12-20 10:45+0100\n"
-"PO-Revision-Date: 2009-01-12 00:47+0100\n"
+"POT-Creation-Date: 2009-10-21 19:27+0200\n"
+"PO-Revision-Date: 2009-07-15 22:49+0100\n"
 "Last-Translator: Diego Pierotto <vdr-italian@tiscali.it>\n"
 "Language-Team: Italian\n"
 "MIME-Version: 1.0\n"
@@ -20,6 +20,7 @@
 "Content-Transfer-Encoding: 8bit\n"
 "X-Poedit-Language: Italian\n"
 "X-Poedit-Country: ITALY\n"
+"X-Poedit-SourceCharset: utf-8\n"
 
 msgid "Channel (press OK): "
 msgstr "Canale (premi OK): "
@@ -27,7 +28,7 @@
 msgid "Page"
 msgstr "Pagina"
 
-msgid "not found"
+msgid "not found until now, searching"
 msgstr "non trovata"
 
 msgid "Displays teletext on the OSD"
@@ -40,7 +41,7 @@
 msgstr "Ingrandisci"
 
 msgid "Half page"
-msgstr "MetÃ Â  pagina"
+msgstr "MetÃ  pagina"
 
 msgid "Change channel"
 msgstr "Cambia canale"
@@ -72,9 +73,11 @@
 msgid "OSD vertical align"
 msgstr "Allineamento verticale OSD"
 
+msgid "Hide mainmenu entry"
+msgstr ""
+
 msgid "Key bindings"
 msgstr "Tasti associati"
 
 msgid "  Page number"
 msgstr "  Numero pagina"
-
diff -Naur osdteletext-0.8.3-orig/po/pt_PT.po osdteletext-0.8.3/po/pt_PT.po
--- osdteletext-0.8.3-orig/po/pt_PT.po	2009-12-11 12:02:42.859939675 +0100
+++ osdteletext-0.8.3/po/pt_PT.po	2009-12-17 19:13:33.000000000 +0100
@@ -1,13 +1,13 @@
 # VDR plugin language source file.
-# Copyright (C) 2007 Klaus Schmidinger <kls@cadsoft.de>
+# Copyright (C) 2007 Klaus Schmidinger <Klaus.Schmidinger@tvdr.de>
 # This file is distributed under the same license as the VDR package.
-# Klaus Schmidinger <kls@cadsoft.de>, 2000
+# Klaus Schmidinger <Klaus.Schmidinger@tvdr.de>, 2000
 #
 msgid ""
 msgstr ""
 "Project-Id-Version: VDR 1.5.7\n"
 "Report-Msgid-Bugs-To: <nobody@nowhere.org>\n"
-"POT-Creation-Date: 2008-12-20 10:45+0100\n"
+"POT-Creation-Date: 2009-10-21 19:27+0200\n"
 "PO-Revision-Date: 2008-05-04 15:33+0200\n"
 "Last-Translator: Chris Silva <hudokkow@gmail.com>\n"
 "Language-Team: Portuguese\n"
@@ -21,7 +21,7 @@
 msgid "Page"
 msgstr "Página"
 
-msgid "not found"
+msgid "not found until now, searching"
 msgstr "Não encontrado"
 
 msgid "Displays teletext on the OSD"
@@ -66,6 +66,9 @@
 msgid "OSD vertical align"
 msgstr "Alinhamento Vertical do OSD"
 
+msgid "Hide mainmenu entry"
+msgstr ""
+
 msgid "Key bindings"
 msgstr "Tecla alocada"
 
diff -Naur osdteletext-0.8.3-orig/po/ru_RU.po osdteletext-0.8.3/po/ru_RU.po
--- osdteletext-0.8.3-orig/po/ru_RU.po	2009-12-11 12:02:42.859939675 +0100
+++ osdteletext-0.8.3/po/ru_RU.po	2009-12-17 19:13:33.000000000 +0100
@@ -1,5 +1,5 @@
 # VDR plugin language source file.
-# Copyright (C) 2007 Klaus Schmidinger <kls@cadsoft.de>
+# Copyright (C) 2007 Klaus Schmidinger <Klaus.Schmidinger@tvdr.de>
 # This file is distributed under the same license as the VDR package.
 # Vyacheslav Dikonov <sdiconov@mail.ru>, 2004
 #
@@ -7,7 +7,7 @@
 msgstr ""
 "Project-Id-Version: VDR 1.5.7\n"
 "Report-Msgid-Bugs-To: <nobody@nowhere.org>\n"
-"POT-Creation-Date: 2008-12-20 10:45+0100\n"
+"POT-Creation-Date: 2009-10-21 19:27+0200\n"
 "PO-Revision-Date: 2008-12-30 13:52+0100\n"
 "Last-Translator: Oleg Roitburd <oleg@roitburd.de>\n"
 "Language-Team: Russian\n"
@@ -21,7 +21,7 @@
 msgid "Page"
 msgstr "ÁâàÐÝØæÐ"
 
-msgid "not found"
+msgid "not found until now, searching"
 msgstr "ÝÕ ÝÐÙÔÕÝÐ"
 
 msgid "Displays teletext on the OSD"
@@ -67,9 +67,11 @@
 msgid "OSD vertical align"
 msgstr "²ÕàâØÚÐÛìÝÞÕ ßÞÛÞÖÕÝØÕ OSD"
 
+msgid "Hide mainmenu entry"
+msgstr ""
+
 msgid "Key bindings"
 msgstr "¿àØÒï×ÚÐ ÚÝÞßÞÚ"
 
 msgid "  Page number"
 msgstr "  ½ÞÜÕà áâàÐÝØæë"
-
diff -Naur osdteletext-0.8.3-orig/po/uk_UA.po osdteletext-0.8.3/po/uk_UA.po
--- osdteletext-0.8.3-orig/po/uk_UA.po	2009-12-11 12:02:42.859939675 +0100
+++ osdteletext-0.8.3/po/uk_UA.po	2009-12-17 19:13:33.000000000 +0100
@@ -1,5 +1,5 @@
 # VDR plugin language source file.
-# Copyright (C) 2007 Klaus Schmidinger <kls@cadsoft.de>
+# Copyright (C) 2007 Klaus Schmidinger <Klaus.Schmidinger@tvdr.de>
 # This file is distributed under the same license as the VDR package.
 # Yarema P. aka Knedlyk <yupadmin@gmail.com>, 2008
 #
@@ -7,7 +7,7 @@
 msgstr ""
 "Project-Id-Version: VDR 1.5.7\n"
 "Report-Msgid-Bugs-To: <nobody@nowhere.org>\n"
-"POT-Creation-Date: 2008-12-20 21:45+0100\n"
+"POT-Creation-Date: 2009-10-21 19:27+0200\n"
 "PO-Revision-Date: 2009-05-25 20:33+0200\n"
 "Last-Translator: Yarema P. aka Knedlyk <yupadmin@gmail.com>\n"
 "Language-Team: Ukrainian\n"
@@ -21,7 +21,7 @@
 msgid "Page"
 msgstr "Ð¡ÑÐ¾ÑÑÐ½ÐºÐ°"
 
-msgid "not found"
+msgid "not found until now, searching"
 msgstr "Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð°"
 
 msgid "Displays teletext on the OSD"
@@ -66,6 +66,9 @@
 msgid "OSD vertical align"
 msgstr "ÐÐµÑÑÐ¸ÐºÐ°Ð»ÑÐ½Ðµ Ð¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ OSD"
 
+msgid "Hide mainmenu entry"
+msgstr ""
+
 msgid "Key bindings"
 msgstr "ÐÑÐ¸Ð·Ð½Ð°ÑÐµÐ½Ð½Ñ ÐºÐ»Ð°Ð²ÑÑ"
 
diff -Naur osdteletext-0.8.3-orig/README osdteletext-0.8.3/README
--- osdteletext-0.8.3-orig/README	2009-12-11 12:02:42.871615145 +0100
+++ osdteletext-0.8.3/README	2009-12-18 14:14:40.240283158 +0100
@@ -97,6 +97,8 @@
                                   one-file-per-page system.
                                   Default is "packed" for the 
                                   one-file-for-a-few-pages system.
+     -t        --toptext          Store top text pages at cache.
+                                  (unviewable pages)
 
 Colors:
   On all sorts of output devices which are not limited as to color depth
diff -Naur osdteletext-0.8.3-orig/README.DE osdteletext-0.8.3/README.DE
--- osdteletext-0.8.3-orig/README.DE	2009-12-11 12:02:42.867827135 +0100
+++ osdteletext-0.8.3/README.DE	2009-12-18 14:14:40.240283158 +0100
@@ -74,6 +74,7 @@
                                   System "Eine Datei - eine Seite".
                                   Voreinstellung ist "packed" fÃ¼r ein System, das
                                   in eine Datei mehrere Seiten speichert.
+     -t        --toptext          Speichere TopText Seiten (nich anzeigbar)
 
 Farben:
   Auf allen AusgabegerÃ¤ten, die nicht in der Farbtiefe des OSD beschrÃ¤nkt sind,
diff -Naur osdteletext-0.8.3-orig/setup.h osdteletext-0.8.3/setup.h
--- osdteletext-0.8.3-orig/setup.h	2009-12-11 12:02:42.871615145 +0100
+++ osdteletext-0.8.3/setup.h	2009-12-18 14:15:16.356345069 +0100
@@ -45,6 +45,7 @@
    int OSDHAlign;
    int OSDVAlign;
    int inactivityTimeout;
+   int HideMainMenu;
 };
 
 extern TeletextSetup ttSetup;
diff -Naur osdteletext-0.8.3-orig/txtfont.c osdteletext-0.8.3/txtfont.c
--- osdteletext-0.8.3-orig/txtfont.c	2009-12-11 12:02:42.871615145 +0100
+++ osdteletext-0.8.3/txtfont.c	2009-12-18 14:15:14.656306702 +0100
@@ -1,4 +1,5 @@
 #include "txtfont.h"
+#include <vdr/config.h>
 
 unsigned int TXT_Mask[11]= {
    0x0000,  // ************ ****
@@ -3136,7 +3137,25 @@
 int NationalOptionSubsetTR[13]=
     {0   ,0   ,0   ,0   ,0x5c,0xd7,0x5d,0   ,0   ,0   ,0x7c,0xcc,0x7d};
 
-
+int DiacriticalMarkNationalOptionSubsetPT_ES[26*TXT_CHARSIZE*16]=
+    {
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0xf1,0x42,0x43,0x44,0xf2,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0xf6,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0xc2,0x62,0x63,0x64,0xc9,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0xc8,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0xf0,0x42,0x43,0x44,0x90,0x46,0x47,0x48,0xf3,0x4a,0x4b,0x4c,0x4d,0x4e,0xf5,0x50,0x51,0x52,0x53,0x54,0xf7,0x56,0x57,0x58,0x59,0x5a,0xeb,0x62,0x63,0x64,0xec,0x66,0x67,0x68,0xed,0x6a,0x6b,0x6c,0x6d,0x6e,0xee,0x70,0x71,0x72,0x73,0x74,0xef,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0xe7,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0xe8,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0xf4,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x5d,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0xd4,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x9a,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0xd7,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0xcc,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,
+	};
 
 inline int NationalOptionSubset(int chr) {
     switch (chr) {
@@ -3180,17 +3199,27 @@
     return res;
 }
 
-
+int DiacriticalMarkNationalOptionChar (int chr, unsigned char mode) {
+	int result=0;
+	if ( mode <= 16 || mode > 31)
+		return 0;	// No extended char
+	if (( chr >= 0x41 && chr <= 0x5a ) || ( chr >= 0x61 && chr <= 0x7a ))
+		result = chr - 0x41;
+	return result;
+}
 
 unsigned int* GetFontChar(cTeletextChar c, unsigned int *buffer) {
     // Get character bitmap for character/charset
 
     enumCharsets font=c.GetCharset();
     int chr=c.GetChar();
+    unsigned char mode=c.GetExtMode();
     unsigned int *bitmap=NULL;
     int i;
     int NationalOption=NationalOptionSubset(chr);
-    
+    int DiacriticalMarkNationalOption=0;
+    DiacriticalMarkNationalOption=DiacriticalMarkNationalOptionChar(chr,mode);
+
     switch (font) {
     case CHARSET_LATIN_G0:
         if (NationalOption>=0) {
@@ -3233,14 +3262,17 @@
         }           
         break;
     case CHARSET_LATIN_G0_PT_ES:
-        if (NationalOption>=0) {
-            if (NationalOptionSubsetPT_ES[NationalOption]>0)
-                bitmap=TXT_Font[NationalOptionSubsetPT_ES[NationalOption]-0x20];
-        } else {
-            if (chr>=0x20 && chr<0x80) {
-                bitmap=TXT_Font[chr-0x20];
-            }
-        }           
+        if (DiacriticalMarkNationalOption>0)
+            bitmap=TXT_Font[DiacriticalMarkNationalOptionSubsetPT_ES[((mode & 0x0f)*26*TXT_CHARSIZE)+DiacriticalMarkNationalOption]-0x20];
+        else {
+            if (NationalOption>=0) {
+                if (NationalOptionSubsetPT_ES[NationalOption]>0)
+                    bitmap=TXT_Font[NationalOptionSubsetPT_ES[NationalOption]-0x20];
+            } else {
+                if (chr>=0x20 && chr<0x80)
+                    bitmap=TXT_Font[chr-0x20];
+            }           
+        }
         break;
     case CHARSET_LATIN_G0_SV_FI:
         if (NationalOption>=0) {
@@ -3305,13 +3337,14 @@
     case CHARSET_GRAPHICS_G3:
     case CHARSET_INVALID:
         // Totally unsupported
+        esyslog("OSD-Teletext: Font Charset invalid");
         break;
     }
     
     
     
     if (!buffer) {
-        printf("Warning: Undefined char: %x %x\n",font,chr);
+        esyslog("OSD-Teletext: Warning: Undefined char: %x %x\n",font,chr);
         return NULL;
     }
     
diff -Naur osdteletext-0.8.3-orig/txtrecv.c osdteletext-0.8.3/txtrecv.c
--- osdteletext-0.8.3-orig/txtrecv.c	2009-12-11 12:02:42.867827135 +0100
+++ osdteletext-0.8.3/txtrecv.c	2009-12-18 14:15:14.659920453 +0100
@@ -14,6 +14,8 @@
 #include "tables.h"
 #include "setup.h"
 #include "menu.h"
+#include "txtfont.h"
+#include "hamm.h"
 
 #include <vdr/channels.h>
 #include <vdr/device.h>
@@ -100,45 +102,22 @@
    return bytesDeleted;
 }
 
-Storage *Storage::s_self = 0;
-Storage::StorageSystem Storage::system = Storage::StorageSystemPacked;
-
 Storage::Storage() {
-   s_self=this;
    byteCount=0;
-   storageOption=-1;
    failedFreeSpace=false;
 }
 
 Storage::~Storage() {
 }
 
-void Storage::setSystem(StorageSystem s) {
-   system=s;
-}
-
-Storage *Storage::instance() {
-   if (!s_self) {
-      switch (system) {
-      case StorageSystemLegacy:
-         s_self=new LegacyStorage();
-         break;
-      case StorageSystemPacked:
-      default:
-         s_self=new PackedStorage();
-         break;
-      }
-   }
-   return s_self;
-}
-
-void Storage::setMaxStorage(int maxMB) {
-   storageOption=maxMB;
-}
-
-void Storage::init() {
-   cleanUp();
-   initMaxStorage(storageOption);
+Storage *Storage::CreateInstance(StorageSystem system, int storageLimit) {
+  switch (system) {
+  case StorageSystemLegacy:
+     return new LegacyStorage(storageLimit);
+  case StorageSystemPacked:
+  default:
+     return new PackedStorage(storageLimit);
+  }
 }
 
 void Storage::freeSpace() {
@@ -147,11 +126,14 @@
    if (failedFreeSpace)
       return;
 
-   //printf("freeSpace()\n");
+   dsyslog("OSD-Teletext: freeSpace()\n");
    time_t min=time(0);
    char minDir[PATH_MAX];
    char fullPath[PATH_MAX];
    int haveDir=0;
+#ifdef VDR_M7x0_VERSION
+   int i_bytesCleared=0;
+#endif
    DIR *top=opendir(getRootDir());
    if (top) {
       struct dirent *chandir, path;
@@ -173,10 +155,18 @@
       closedir(top);
 
       //if haveDir, only current directory present, which must not be deleted
-      if (haveDir>=2)
+      if (haveDir>=2) {
+#ifdef VDR_M7x0_VERSION
+         i_bytesCleared=cleanSubDir(minDir);
+         byteCount-=i_bytesCleared;
+         dsyslog("OSD-Teletext: Removed cache dir '%s', freed %i bytes,new cache size is %i", minDir, i_bytesCleared, (int)byteCount);
+#else
          byteCount-=cleanSubDir(minDir);
-      else
+#endif
+      } else {
+         esyslog("OSD-Teletext: Caching problem!, no old cache files left to remove. Cache size is %i", (int)byteCount);
          failedFreeSpace=true;
+      }
    }
 }
 
@@ -200,12 +190,16 @@
    failedFreeSpace=false;
 }
 
-#define TELETEXT_PAGESIZE 972
+#define TELETEXT_PAGESIZE (972*TXT_CHARSIZE)
 
-LegacyStorage::LegacyStorage() {
-   maxBytes=0;
+LegacyStorage::LegacyStorage(int maxMB) {
+#ifdef VDR_M7x0_VERSION
+   // create cache dir
+   MakeDirs(RootDir::getRootDir(), true);
+#endif
    fsBlockSize=1;
    pageBytes=TELETEXT_PAGESIZE;
+   initMaxStorage(maxMB);
 }
 
 LegacyStorage::~LegacyStorage() {
@@ -248,6 +242,7 @@
          maxMB=3;
       }
       maxBytes=MEGABYTE(maxMB);
+      dsyslog("OSD-Teletext: Set maxBytes to %ld", maxBytes);
    } else if (maxMB==-1) {
       //calculate a default value
       double blocksPerMeg = 1024.0 * 1024.0 / fs.f_bsize;
@@ -266,7 +261,7 @@
          //the maximum default size is set to 50 MB
          maxBytes=MEGABYTE(50);
       }
-      //printf("Set maxBytes to %ld, %.2f %.2f\n", maxBytes, capacityMB, freeMB);
+      dsyslog("OSD-Teletext: Set maxBytes to %ld, cap:%.2f free:%.2f\n", maxBytes, capacityMB, freeMB);
    }
 }
 
@@ -335,7 +330,8 @@
 
 
 
-PackedStorage::PackedStorage() {
+PackedStorage::PackedStorage(int maxMB)
+ : LegacyStorage(maxMB) {
 }
 #define TOC_SIZE 8
 //The file structure is simple:
@@ -457,15 +453,23 @@
 
 
 
-cTelePage::cTelePage(PageID t_page, uchar t_flags, uchar t_lang,int t_mag)
-  : mag(t_mag), flags(t_flags), lang(t_lang), page(t_page)
+cTelePage::cTelePage(PageID t_page, uchar t_flags, uchar t_lang,int t_mag, Storage *s)
+  : mag(t_mag), flags(t_flags), lang(t_lang), page(t_page), storage(s)
 {
    memset(pagebuf,' ',26*40);
+   memset(pagebuf_ext,' ',26*40*TXT_CHARSIZE);
 }
 
 cTelePage::~cTelePage() {
 }
 
+void cTelePage::SetData(int line,int col, uchar c,uchar mode)
+{
+  int pos = (40*line + col)* TXT_CHARSIZE;
+  pagebuf_ext[pos]=mode;
+  pagebuf_ext[pos+1]=c;
+}
+
 void cTelePage::SetLine(int line, uchar *myptr)
 {
    memcpy(pagebuf+40*line,myptr,40);
@@ -473,25 +477,43 @@
 
 void cTelePage::save()
 {
-   Storage *s=Storage::instance();
    unsigned char buf;
    StorageHandle fd;
-   if ( (fd=s->openForWriting(page)) ) {
-      s->write("VTXV4",5,fd);
-      buf=0x01; s->write(&buf,1,fd);
-      buf=mag;  s->write(&buf,1,fd);
-      buf=page.page; s->write(&buf,1,fd);
-      buf=flags; s->write(&buf,1,fd);
-      buf=lang; s->write(&buf,1,fd);
-      buf=0x00; s->write(&buf,1,fd);
-      buf=0x00; s->write(&buf,1,fd);
-      s->write(pagebuf,24*40,fd);
-      s->close(fd);
-   }         
+
+   // Set extended characters
+   int i, j, pos, pos_ext;
+   for (i=0; i<24; i++) {
+      for (j=0; j<40 ; j++) {
+         pos = (i*40+j);
+         pos_ext = pos*TXT_CHARSIZE;
+         if (pagebuf_ext[pos_ext] == ' ')
+            pagebuf_ext[pos_ext+1]= pagebuf[pos];
+         /*else
+            dsyslog("OSD-Teletext: SetData: pagebuf %x->%x", pagebuf[pos], pagebuf_ext[pos_ext]);*/
+      }
+   }
+
+   if ( (fd=storage->openForWriting(page)) ) {
+      storage->write("VTXV4",5,fd);
+      buf=0x01; storage->write(&buf,1,fd);
+      buf=mag;  storage->write(&buf,1,fd);
+      buf=page.page; storage->write(&buf,1,fd);
+      buf=flags; storage->write(&buf,1,fd);
+      buf=lang; storage->write(&buf,1,fd);
+      buf=0x00; storage->write(&buf,1,fd);
+      buf=0x00; storage->write(&buf,1,fd);
+      storage->write(pagebuf_ext,24*40*TXT_CHARSIZE,fd);
+      storage->close(fd);
+   }
 }
 
+bool cTelePage::IsTopTextPage()
+{
+   return (page.page & 0xFF) > 0x99 || (page.page & 0x0F) > 0x9;
+}
 
-cTxtStatus::cTxtStatus(void)
+cTxtStatus::cTxtStatus(bool storeTopText, Storage* storage)
+ :storeTopText(storeTopText), storage(storage)
 {
    receiver = NULL;
    currentLiveChannel = tChannelID::InvalidID;
@@ -528,10 +550,15 @@
    delete receiver;
    receiver = NULL;
 
+#ifdef VDR_M7x0_VERSION
+   // Clean cache here because M7x0 have a limited storage
+   Storage::instance()->cleanUp();
+#endif
+
    int TPid = newLiveChannel->Tpid();
 
    if (TPid) {
-      receiver = new cTxtReceiver(TPid, currentLiveChannel);
+      receiver = new cTxtReceiver(TPid, currentLiveChannel, storeTopText, storage);
       cDevice::ActualDevice()->AttachReceiver(receiver);
    }
 
@@ -539,11 +566,17 @@
 }
 
 
-cTxtReceiver::cTxtReceiver(int TPid, tChannelID chan)
- : cReceiver(chan, -1, TPid), cThread("osdteletext-receiver"),
-   chan(chan), TxtPage(0), buffer((188+60)*75), running(false)
+cTxtReceiver::cTxtReceiver(int TPid, tChannelID chan, bool storeTopText, Storage* storage)
+#if VDRVERSNUM >= 10500
+ : cReceiver(chan, -1, TPid), 
+#else
+ : cReceiver(0, -1, TPid), 
+#endif
+ cThread("osdteletext-receiver"),
+   TxtPage(0), storeTopText(storeTopText), buffer((188+60)*75), storage(storage)
 {
-   Storage::instance()->prepareDirectory(chan);
+   storage->prepareDirectory(ChannelID());
+
    // 10 ms timeout on getting TS frames
    buffer.SetTimeouts(0, 10);
 }
@@ -551,12 +584,8 @@
 
 cTxtReceiver::~cTxtReceiver()
 {
-   cReceiver::Detach();
-   if (running) {
-      running=false;
-      buffer.Signal();
-      Cancel(2);
-   }
+   Detach();
+   Activate(false);
    buffer.Clear();
    delete TxtPage;
 }
@@ -569,13 +598,11 @@
 void cTxtReceiver::Activate(bool On)
 {
   if (On) {
-     if (!running) {
-        running=true;
+     if (!Running()) {
         Start();
         }
      }
-  else if (running) {
-     running = false;
+  else if (Running()) {
      buffer.Signal();
      Cancel(2);
      }
@@ -583,24 +610,39 @@
 
 void cTxtReceiver::Receive(uchar *Data, int Length)
 {
-   int len = Length+60;
-
-   if (!buffer.Check(len)) {
-      // Buffer overrun
-      buffer.Signal();
+#ifdef VDR_M7x0_VERSION
+   uchar *ts_data = MALLOC(uchar, 188);
+   if (!ts_data) {
+      esyslog ("OSD-Teletext: Memory allocation error in txtreceiver");
       return;
    }
-   cFrame *frame=new cFrame(Data, len);
-   if (frame && !buffer.Put(frame)) {
+
+   while (Length >= 188) {
+      memcpy(ts_data, Data, 188);
+      Data += 188;
+      cFrame *frame = new cFrame(ts_data, 188);
+      if (!buffer.Put(frame)) {
+         delete frame;
+         buffer.Signal();
+         break;
+      }
+      Length -= 188;
+   }
+
+   free(ts_data);
+#else
+   cFrame *frame=new cFrame(Data, Length);
+   if (!buffer.Put(frame)) {
       // Buffer overrun
       delete frame;
       buffer.Signal();
    }
+#endif
 }
 
 void cTxtReceiver::Action() {
 
-   while (running) {
+   while (Running()) {
       cFrame *frame=buffer.Get();
       if (frame) {
          uchar *Datai=frame->Data();
@@ -619,7 +661,6 @@
    }
 
    buffer.Clear();
-   running=false;
 }
 
 uchar cTxtReceiver::unham16 (uchar *p)
@@ -630,6 +671,17 @@
   return (c1 & 0x0F) | (c2 & 0x0F) *16;
 }
 
+void cTxtReceiver::SaveAndDeleteTxtPage()
+{
+  if (TxtPage) {
+     if (storeTopText || !TxtPage->IsTopTextPage()) {
+        TxtPage->save();
+        delete TxtPage;
+        TxtPage=NULL;
+     }
+  }
+}
+
 void cTxtReceiver::DecodeTXT(uchar* TXT_buf)
 {
    // Format of buffer:
@@ -664,6 +716,12 @@
    int hdr,mag,mag8,line;
    uchar *ptr;
    uchar flags,lang;
+   int i = 1;
+   uchar *aptr;
+   int triplet;
+   uchar address=0;
+   uchar mode=0,data=0;
+   uchar active_row=0;
 
    hdr = unham16 (&TXT_buf[0x8]);
    mag = hdr & 0x07;
@@ -680,11 +738,7 @@
       // Page no, 10- and 1-digit
 
       if (b1 == 0xff) break;
-      if (TxtPage) {
-         TxtPage->save();
-         delete TxtPage;
-         TxtPage=NULL;
-      }
+      SaveAndDeleteTxtPage();
 
       b2 = unham16 (ptr+2); // Sub-code 0..6 + C4
       b3 = unham16 (ptr+4); // Sub-code 8..13 + C5,C6
@@ -707,7 +761,7 @@
       pgno = mag8 * 256 + b1;
       subno = (b2 + b3 * 256) & 0x3f7f;         // Sub Page Number
 
-      TxtPage = new cTelePage(PageID(chan, pgno, subno), flags, lang, mag);
+      TxtPage = new cTelePage(PageID(ChannelID(), pgno, subno), flags, lang, mag, storage);
       TxtPage->SetLine((int)line,(uchar *)ptr);
       break;
       }
@@ -716,13 +770,23 @@
       if (TxtPage) TxtPage->SetLine((int)line,(uchar *)ptr); 
       break;
       }
+   case 26:{ // Extended characters Level 1.5 - diacritical mark
+      aptr=ptr+1;
+      for (i = 0; i < 13; i++) {
+          triplet = vbi3_unham24p (aptr+(i*3));
+          address=triplet & 0x3f;
+          mode=(triplet >> 6) & 0x1f;
+          data=(triplet >>11) & 0x7f;
+          if (address > 39 && mode == 4)
+             active_row = address-40;
+          if (address <=39 && mode >=16 && mode < 31) {
+             if (TxtPage) TxtPage->SetData(active_row,address,data,mode);
+          }
+      }
+   }
    /*case 23: 
       {
-      if (TxtPage) {
-         TxtPage->save();
-         delete TxtPage;
-         TxtPage=NULL;
-      }
+      SaveAndDeleteTxtPage();
       break;
       }*/
    default:
diff -Naur osdteletext-0.8.3-orig/txtrecv.h osdteletext-0.8.3/txtrecv.h
--- osdteletext-0.8.3-orig/txtrecv.h	2009-12-11 12:02:42.867827135 +0100
+++ osdteletext-0.8.3/txtrecv.h	2009-12-18 14:15:16.356345069 +0100
@@ -55,17 +55,14 @@
    virtual ~Storage();
    enum StorageSystem { StorageSystemLegacy, StorageSystemPacked };
    //must be called before the first call to instance()
-   static void setSystem(StorageSystem system);
-   void setMaxStorage(int maxMB=-1);
    
-   static Storage *instance();
+   static Storage *CreateInstance(StorageSystem system, int storageLimit);
    
    //must be called before operation starts. Set all options (RootDir, maxStorage) before.
-   void init();   
    virtual void cleanUp() = 0;
    
    virtual void getFilename(char *buffer, int bufLength, PageID page);
-   void prepareDirectory(tChannelID chan);
+   virtual void prepareDirectory(tChannelID chan);
    
    virtual StorageHandle openForWriting(PageID page) = 0;
    virtual StorageHandle openForReading(PageID page, bool countAsAccess) = 0;
@@ -73,27 +70,24 @@
    virtual ssize_t read(void *ptr, size_t size, StorageHandle stream) = 0;
    virtual void close(StorageHandle stream) = 0;
 protected:
-   virtual void initMaxStorage(int maxMB=-1) = 0;
-   
    Storage();
    int cleanSubDir(const char *dir);
    int doCleanUp();
    virtual int actualFileSize(int netFileSize) { return netFileSize; }
-   static Storage *s_self;
    void freeSpace();
    bool exists(const char* file);
    
    long byteCount;
    cString currentDir;
 private:
-   static StorageSystem system;
-   int storageOption;
    bool failedFreeSpace;
 };
 
 class LegacyStorage : public Storage {
+private:
+   void initMaxStorage(int maxMB=-1);
 public:
-   LegacyStorage();
+   LegacyStorage(int maxMB);
    virtual ~LegacyStorage();
    virtual void cleanUp();
    
@@ -105,7 +99,6 @@
    virtual void close(StorageHandle stream)
      { ::close((int)stream); }
 protected:
-   virtual void initMaxStorage(int maxMB=-1);
    void registerFile(PageID page);
    virtual int actualFileSize(int netFileSize);
    //int maxPages;
@@ -116,9 +109,7 @@
 
 class PackedStorage : public LegacyStorage {
 public:
-   PackedStorage();
-   //virtual void setMaxStorage(int maxMB=-1);
-   //virtual void cleanUp();
+   PackedStorage(int maxMB);
    
    virtual void getFilename(char *buffer, int bufLength, PageID page);
    virtual StorageHandle openForWriting(PageID page);
@@ -143,12 +134,15 @@
   unsigned char lang;
   PageID page;
   unsigned char pagebuf[27*40];
-  char Directory [255];
+  unsigned char pagebuf_ext[27*40*TXT_CHARSIZE]; // diacritical-mark
+  Storage* storage;
  public:
-  cTelePage(PageID page, uchar flags, uchar lang, int mag);
+  cTelePage(PageID page, uchar flags, uchar lang, int mag, Storage *s);
   ~cTelePage();
   void SetLine(int, uchar*);
   void save();
+  bool IsTopTextPage();
+  void SetData(int line, int col, uchar c, uchar mode);
  };
 
 class cRingTxtFrames : public cRingBufferFrame {
@@ -157,23 +151,23 @@
   ~cRingTxtFrames() { Clear(); };
   void Wait(void) { WaitForGet(); };
   void Signal(void) { EnableGet(); };
-  bool Check(int Size) { return (Free() >= Size); };
 };
 
 class cTxtReceiver : public cReceiver, public cThread {
 private:
    void DecodeTXT(uchar*);
    uchar unham16 (uchar*);
-   tChannelID chan;
    cTelePage *TxtPage;
+   void SaveAndDeleteTxtPage();
+   bool storeTopText;
+   cRingTxtFrames buffer;
+   Storage *storage;
 protected:
    virtual void Activate(bool On);
    virtual void Receive(uchar *Data, int Length);
-   void Action();
-   cRingTxtFrames buffer;
-   bool running;
+   virtual void Action();
 public:
-   cTxtReceiver(int TPid, tChannelID chan);
+   cTxtReceiver(int TPid, tChannelID chan, bool storeTopText, Storage* storage);
    virtual ~cTxtReceiver();
    virtual void Stop();
 };
@@ -182,10 +176,12 @@
 private:
    cTxtReceiver *receiver;
    tChannelID currentLiveChannel;
+   bool storeTopText;
+   Storage* storage;
 protected:
    virtual void ChannelSwitch(const cDevice *Device, int ChannelNumber);
 public:
-   cTxtStatus(void);
+   cTxtStatus(bool storeTopText, Storage* storage);
    ~cTxtStatus();
 };
 
diff -Naur osdteletext-0.8.3-orig/txtrender.c osdteletext-0.8.3/txtrender.c
--- osdteletext-0.8.3-orig/txtrender.c	2009-12-11 12:02:42.871615145 +0100
+++ osdteletext-0.8.3/txtrender.c	2009-12-18 14:15:14.659920453 +0100
@@ -323,13 +323,15 @@
         // Pre-scan for double-height and double-size codes
         for (x=0;x<40;x++) {
             if (y==0 && x<8) x=8;
-            if ((PageCode[x+40*y] & 0x7f)==0x0D || (PageCode[x+40*y] & 0x7f)==0x0F)
+            if ((PageCode[((x+40*y)*TXT_CHARSIZE)+1] & 0x7f)==0x0D || (PageCode[((x+40*y)*TXT_CHARSIZE)+1] & 0x7f)==0x0F)
                 EmptyNextLine=true;
         }
 
         // Move through line
         for (x=0;x<40;x++) {
-            unsigned char ttc=PageCode[x+40*y] & 0x7f;
+            unsigned char ttc=PageCode[((x+40*y)*TXT_CHARSIZE)+1] & 0x7f;
+            unsigned char mode=PageCode[(x+40*y)*TXT_CHARSIZE];
+
             // skip parity check
 
             if (y==0 && x<8) continue;
@@ -396,7 +398,7 @@
                 }
             } else {
                 // Character code               
-                c2.SetChar(ttc);
+                c2.SetChar(ttc, mode);
                 if (GraphicCharset) {
                     if (ttc&0x20) {
                         // real graphics code, remember for HoldMosaics
diff -Naur osdteletext-0.8.3-orig/txtrender.h osdteletext-0.8.3/txtrender.h
--- osdteletext-0.8.3-orig/txtrender.h	2009-12-11 12:02:42.876165129 +0100
+++ osdteletext-0.8.3/txtrender.h	2009-12-18 14:15:16.356345069 +0100
@@ -111,6 +111,7 @@
     
 protected:
     unsigned int c;
+    unsigned char m;
 
     static const unsigned int CHAR             = 0x000000FF;
     // character code
@@ -133,10 +134,10 @@
     static const unsigned int BLINK            = 0x80000000;
     // blinking character
 
-    cTeletextChar(unsigned int cc) { c=cc; }
+    cTeletextChar(unsigned int cc, unsigned char mm=' ') { c=cc; m=mm; }
 
 public:
-    cTeletextChar() { c=0; }
+    cTeletextChar() { c=0; m=' '; }
     
     // inline helper functions:
     // For each parameter encoded into the 32-bit int, there is
@@ -145,8 +146,10 @@
     
     inline unsigned char GetChar() 
         { return c&CHAR; }
-    inline void SetChar(unsigned char chr)
-        { c=(c&~CHAR)|chr; }
+    inline void SetChar(unsigned char chr, unsigned char mode=' ')
+        { c=(c&~CHAR)|chr; m=mode; }
+    inline unsigned char GetExtMode()
+        { return m; }
     inline cTeletextChar ToChar(unsigned char chr)
         { return cTeletextChar((c&~CHAR)|chr); }
         
@@ -155,66 +158,66 @@
     inline void SetCharset(enumCharsets charset) 
         { c=(c&~CHARSET)|charset; }
     inline cTeletextChar ToCharset(enumCharsets charset) 
-        { return cTeletextChar((c&~CHARSET)|charset); }
+        { return cTeletextChar((c&~CHARSET)|charset, m); }
     
     inline enumTeletextColor GetFGColor() 
         { return (enumTeletextColor)((c&FGCOLOR) >> LowestSet32Bit(FGCOLOR)); }
     inline void SetFGColor(enumTeletextColor fgc) 
         { c=(c&~FGCOLOR) | (fgc << LowestSet32Bit(FGCOLOR)); }
     inline cTeletextChar ToFGColor(enumTeletextColor fgc) 
-        { return cTeletextChar((c&~FGCOLOR) | (fgc << LowestSet32Bit(FGCOLOR))); }
+        { return cTeletextChar((c&~FGCOLOR) | (fgc << LowestSet32Bit(FGCOLOR)), m); }
     
     inline enumTeletextColor GetBGColor() 
         { return (enumTeletextColor)((c&BGCOLOR) >> LowestSet32Bit(BGCOLOR)); }
     inline void SetBGColor(enumTeletextColor bgc) 
         { c=(c&~BGCOLOR) | (bgc << LowestSet32Bit(BGCOLOR)); }
     inline cTeletextChar ToBGColor(enumTeletextColor bgc) 
-        { return cTeletextChar((c&~BGCOLOR) | (bgc << LowestSet32Bit(BGCOLOR))); }
+        { return cTeletextChar((c&~BGCOLOR) | (bgc << LowestSet32Bit(BGCOLOR)), m); }
     
     inline bool GetBoxedOut() 
         { return c&BOXOUT; }
     inline void SetBoxedOut(bool BoxedOut) 
         { c=(BoxedOut)?(c|BOXOUT):(c&~BOXOUT); }
     inline cTeletextChar ToBoxedOut(bool BoxedOut) 
-        { return cTeletextChar((BoxedOut)?(c|BOXOUT):(c&~BOXOUT)); }
+        { return cTeletextChar((BoxedOut)?(c|BOXOUT):(c&~BOXOUT), m); }
     
     inline bool GetDirty() 
         { return c&DIRTY; }
     inline void SetDirty(bool Dirty) 
         { c=(Dirty)?(c|DIRTY):(c&~DIRTY); }
     inline cTeletextChar ToDirty(bool Dirty) 
-        { return cTeletextChar((Dirty)?(c|DIRTY):(c&~DIRTY)); }
+        { return cTeletextChar((Dirty)?(c|DIRTY):(c&~DIRTY), m); }
     
     inline enumDblHeight GetDblHeight() 
         { return (enumDblHeight)(c&DBLHEIGHT); }
     inline void SetDblHeight(enumDblHeight dh) 
         { c=(c&~(DBLHEIGHT)) | dh; }
     inline cTeletextChar ToDblHeight(enumDblHeight dh) 
-        { return cTeletextChar((c&~(DBLHEIGHT)) | dh); }
+        { return cTeletextChar((c&~(DBLHEIGHT)) | dh, m); }
     
     inline enumDblWidth GetDblWidth() 
         { return (enumDblWidth)(c&DBLWIDTH); }
     inline void SetDblWidth(enumDblWidth dw) 
         { c=(c&~(DBLWIDTH)) | dw; }
     inline cTeletextChar ToDblWidth(enumDblWidth dw) 
-        { return cTeletextChar((c&~(DBLWIDTH)) | dw); }
+        { return cTeletextChar((c&~(DBLWIDTH)) | dw, m); }
     
     inline bool GetConceal() 
         { return c&CONCEAL; }
     inline void SetConceal(bool Conceal) 
         { c=(Conceal)?(c|CONCEAL):(c&~CONCEAL); }
     inline cTeletextChar ToConceal(bool Conceal) 
-        { return cTeletextChar((Conceal)?(c|CONCEAL):(c&~CONCEAL)); }
+        { return cTeletextChar((Conceal)?(c|CONCEAL):(c&~CONCEAL), m); }
     
     inline bool GetBlink() 
         { return c&BLINK; }
     inline void SetBlink(bool Blink) 
         { c=(Blink)?(c|BLINK):(c&~BLINK); }
     inline cTeletextChar ToBlink(bool Blink) 
-        { return cTeletextChar((Blink)?(c|BLINK):(c&~BLINK)); }
+        { return cTeletextChar((Blink)?(c|BLINK):(c&~BLINK), m); }
         
-    bool operator==(cTeletextChar &chr) { return c==chr.c; }
-    bool operator!=(cTeletextChar &chr) { return c!=chr.c; }
+    bool operator==(cTeletextChar &chr) { return c==chr.c && m==chr.m; }
+    bool operator!=(cTeletextChar &chr) { return c!=chr.c || m!=chr.m; }
 };
 
 
