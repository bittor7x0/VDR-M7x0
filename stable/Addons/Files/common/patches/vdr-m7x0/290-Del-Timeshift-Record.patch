Gemeinsame Unterverzeichnisse: vdr-1.4.7-original/libsi und vdr-1.4.7-patched/libsi.
diff -u vdr-1.4.7-original/menu.c vdr-1.4.7-patched/menu.c
--- vdr-1.4.7-original/menu.c	2006-12-02 12:12:02.000000000 +0100
+++ vdr-1.4.7-patched/menu.c	2008-01-12 11:53:41.000000000 +0100
@@ -3836,6 +3836,61 @@
      currentReplayControl = NULL;
 }
 
+void cReplayControl::Stop(void)
+{
+  int dummy;
+  bool playing = GetIndex(dummy, dummy, false);
+  cRecordControl* rc = cRecordControls::GetRecordControl(fileName);
+  
+  if(playing && rc && rc->InstantId())
+  {
+     isyslog("found Timeshiftrecording");
+   
+     if (Interface->Confirm(tr("Delete recording?")))
+     {
+        cRecordControl *rc = cRecordControls::GetRecordControl(fileName);
+        if (rc)
+        {
+           cTimer *timer = rc->Timer();
+           if (timer)
+           {
+              const char* reccmd_backup = cRecordingUserCommand::GetCommand();
+              cRecordingUserCommand::SetCommand(NULL);
+ 
+              timer->Skip();
+              cRecordControls::Process(time(NULL));
+              if (timer->IsSingleEvent())
+              {
+                 isyslog("deleting timer %s", *timer->ToDescr());
+                 Timers.Del(timer);
+              }
+              Timers.SetModified();
+
+              // restore reccmd
+              cRecordingUserCommand::SetCommand(reccmd_backup);
+           }
+        }
+        isyslog("stop replaying %s", fileName);
+        cDvbPlayerControl::Stop();
+
+        cRecording *recording = Recordings.GetByName(fileName);;
+        if (recording)
+        {
+           if (recording->Delete())
+           {
+              Recordings.DelByName(fileName);
+              ClearLastReplayed(fileName);
+              return;
+           }
+           else
+              Skins.Message(mtError, tr("Error while deleting recording!"));
+        }
+     }
+     else
+        cDvbPlayerControl::Stop();
+  }
+}
+
 void cReplayControl::SetRecording(const char *FileName, const char *Title)
 {
   free(fileName);
diff -u vdr-1.4.7-original/menu.h vdr-1.4.7-patched/menu.h
--- vdr-1.4.7-original/menu.h	2006-10-20 15:09:57.000000000 +0200
+++ vdr-1.4.7-patched/menu.h	2008-01-10 00:44:56.000000000 +0100
@@ -246,6 +246,7 @@
 public:
   cReplayControl(void);
   virtual ~cReplayControl();
+  void Stop(void);
   virtual cOsdObject *GetInfo(void);
   virtual eOSState ProcessKey(eKeys Key);
   virtual void Show(void);
Gemeinsame Unterverzeichnisse: vdr-1.4.7-original/PLUGINS und vdr-1.4.7-patched/PLUGINS.
diff -u vdr-1.4.7-original/recording.h vdr-1.4.7-patched/recording.h
--- vdr-1.4.7-original/recording.h	2006-12-01 16:06:07.000000000 +0100
+++ vdr-1.4.7-patched/recording.h	2008-01-12 11:57:21.000000000 +0100
@@ -170,6 +170,7 @@
 private:
   static const char *command;
 public:
+  static const char *GetCommand(void) { return command; }
   static void SetCommand(const char *Command) { command = Command; }
   static void InvokeCommand(const char *State, const char *RecordingFileName);
   };
Gemeinsame Unterverzeichnisse: vdr-1.4.7-original/symbols und vdr-1.4.7-patched/symbols.
